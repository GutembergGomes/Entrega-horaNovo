<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GGOMES-LOG v8.3 - ENTREGA 24h APRIMORADA: Interface Otimizada + Análise Individual</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#5D5CDE',
                            '50': '#EEEEFF',
                            '100': '#D4D4F7',
                            '200': '#ACACEF',
                            '300': '#8584E7',
                            '400': '#5D5CDE',
                            '500': '#3635D5',
                            '600': '#2A29B0',
                            '700': '#211F8A',
                            '800': '#171664',
                            '900': '#0D0C3E'
                        },
                        success: {
                            DEFAULT: '#10B981',
                            light: '#6EE7B7',
                            dark: '#047857'
                        },
                        warning: {
                            DEFAULT: '#F59E0B',
                            light: '#FCD34D',
                            dark: '#D97706'
                        },
                        danger: {
                            DEFAULT: '#EF4444',
                            light: '#FCA5A5',
                            dark: '#DC2626'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.6s ease-in-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                        'slide-down': 'slideDown 0.4s ease-out',
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                        'bounce-subtle': 'bounceSubtle 0.6s ease-in-out',
                        'scale-in': 'scaleIn 0.3s ease-out',
                        'shimmer': 'shimmer 2s ease-in-out infinite',
                        'float': 'float 3s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(15px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(100%)' },
                            '100%': { transform: 'translateY(0)' }
                        },
                        slideDown: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(0)' }
                        },
                        bounceSubtle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' }
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.95)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        shimmer: {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-10px)' }
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 5px rgba(93, 92, 222, 0.5)' },
                            '100%': { boxShadow: '0 0 20px rgba(93, 92, 222, 0.8)' }
                        }
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        [x-cloak] { display: none !important; }
        
        .input-number {
            -moz-appearance: textfield;
            appearance: textfield;
        }
        .input-number::-webkit-outer-spin-button,
        .input-number::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { 
            background: rgba(156, 163, 175, 0.4); 
            border-radius: 6px; 
            transition: all 0.3s ease;
        }
        ::-webkit-scrollbar-thumb:hover { background: rgba(156, 163, 175, 0.7); }
        .dark ::-webkit-scrollbar-thumb { background: rgba(75, 85, 99, 0.6); }
        .dark ::-webkit-scrollbar-thumb:hover { background: rgba(75, 85, 99, 0.8); }

        .loading-dots::after {
            content: '';
            animation: loading-dots 1.5s infinite;
        }
        @keyframes loading-dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .dark .glass {
            background: rgba(17, 24, 39, 0.9);
            border: 1px solid rgba(75, 85, 99, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .interactive {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .interactive:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }
        .dark .interactive:hover {
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6);
        }

        .nav-link {
            @apply flex items-center space-x-3 px-4 py-3 rounded-xl text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-300 group relative overflow-hidden;
        }
        
        .nav-link.active {
            @apply bg-gradient-to-r from-primary to-primary-600 text-white shadow-lg;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .nav-link:hover::before {
            left: 100%;
        }

        .tooltip {
            position: relative;
        }
        .tooltip::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            pointer-events: none;
        }
        .tooltip:hover::before {
            opacity: 1;
            visibility: visible;
        }

        .focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.3);
            border-color: #5D5CDE;
        }

        .data-card {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%);
            border: 1px solid rgba(255,255,255,0.3);
        }
        .dark .data-card {
            background: linear-gradient(135deg, rgba(31,41,55,0.95) 0%, rgba(17,24,39,0.9) 100%);
            border: 1px solid rgba(75,85,99,0.3);
        }
        .data-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #5D5CDE, #10B981, #F59E0B);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        .status-success { background-color: #10B981; }
        .status-warning { background-color: #F59E0B; }
        .status-danger { background-color: #EF4444; }
        .status-info { background-color: #3B82F6; }

        .efficiency-bar {
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            background: #e5e7eb;
            position: relative;
        }
        .dark .efficiency-bar {
            background: #374151;
        }

        .efficiency-fill {
            height: 100%;
            transition: width 1s ease-in-out;
            position: relative;
            overflow: hidden;
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }

        .floating-action {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 40;
            background: linear-gradient(135deg, #5D5CDE, #3635D5);
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 8px 25px rgba(93, 92, 222, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            animation: float 3s ease-in-out infinite;
        }
        .floating-action:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(93, 92, 222, 0.4);
        }

        .time-tab-btn {
            transition: all 0.3s ease;
        }
        .time-tab-btn.active {
            background: linear-gradient(135deg, #5D5CDE, #3635D5);
            color: white;
            box-shadow: 0 4px 15px rgba(93, 92, 222, 0.3);
        }

        .input-success { 
            border-color: #10B981 !important; 
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1) !important;
        }
        .input-warning { 
            border-color: #F59E0B !important; 
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1) !important;
        }
        .input-error { 
            border-color: #EF4444 !important; 
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }

        .table-row:hover {
            background: rgba(93, 92, 222, 0.08);
            transform: scale(1.01);
        }
        .dark .table-row:hover {
            background: rgba(93, 92, 222, 0.15);
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #EF4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        .sidebar-transition {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .search-result:hover {
            background: rgba(93, 92, 222, 0.1);
            transform: translateX(4px);
        }
        .dark .search-result:hover {
            background: rgba(93, 92, 222, 0.2);
        }

        .data-input {
            transition: all 0.3s ease;
        }

        .data-input:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.2);
        }

        .spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .hidden { display: none !important; }
        .page-content { display: block; }
        .page-content.hidden { display: none; }

        .period-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }

        .time-period-card {
            background: rgba(255, 255, 255, 0.8);
            border: 2px solid rgba(93, 92, 222, 0.2);
            border-radius: 12px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .dark .time-period-card {
            background: rgba(31, 41, 55, 0.8);
            border-color: rgba(93, 92, 222, 0.4);
        }

        .time-period-card:hover {
            border-color: #5D5CDE;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(93, 92, 222, 0.2);
        }

        .time-period-card.active {
            background: linear-gradient(135deg, #5D5CDE, #3635D5);
            color: white;
            border-color: #5D5CDE;
            box-shadow: 0 6px 20px rgba(93, 92, 222, 0.4);
        }

        .time-period-card.has-data::after {
            content: '';
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            background: #10B981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .live-data {
            position: relative;
        }

        .live-data::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 8px;
            height: 8px;
            background: #10B981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .modal-overlay {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(12px);
        }

        .config-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%);
            border: 1px solid rgba(93, 92, 222, 0.2);
        }
        .dark .config-card {
            background: linear-gradient(135deg, rgba(31,41,55,0.95) 0%, rgba(17,24,39,0.9) 100%);
            border: 1px solid rgba(93, 92, 222, 0.3);
        }

        .tab-button {
            @apply px-4 py-2 text-sm font-medium rounded-lg transition-all duration-300;
        }
        .tab-button.active {
            @apply bg-primary text-white shadow-lg;
        }
        .tab-button:not(.active) {
            @apply bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600;
        }

        .input-mode-btn {
            @apply px-4 py-2 text-sm font-medium rounded-md transition-all duration-300;
        }
        .input-mode-btn.active {
            @apply bg-primary text-white shadow-lg;
        }
        .input-mode-btn:not(.active) {
            @apply text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white;
        }

        .input-mode-content {
            animation: fadeIn 0.3s ease-in-out;
        }

        .period-input-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%);
            border: 1px solid rgba(93, 92, 222, 0.2);
            transition: all 0.3s ease;
        }
        .dark .period-input-card {
            background: linear-gradient(135deg, rgba(31,41,55,0.95) 0%, rgba(17,24,39,0.9) 100%);
            border: 1px solid rgba(93, 92, 222, 0.3);
        }
        .period-input-card:hover {
            border-color: rgba(93, 92, 222, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(93, 92, 222, 0.15);
        }

        .quick-actions-menu {
            animation: slideUpAndFade 0.3s ease-out;
        }

        @keyframes slideUpAndFade {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Enhanced Dark Mode Support */
        .dark {
            color-scheme: dark;
        }

        .dark .glass {
            background: rgba(17, 24, 39, 0.95);
            border: 1px solid rgba(75, 85, 99, 0.4);
        }

        .dark .data-card {
            background: linear-gradient(135deg, rgba(31,41,55,0.98) 0%, rgba(17,24,39,0.95) 100%);
            border: 1px solid rgba(75,85,99,0.4);
        }

        .dark .time-period-card {
            background: rgba(31, 41, 55, 0.9);
            color: #E5E7EB;
        }

        .dark .config-card {
            background: linear-gradient(135deg, rgba(31,41,55,0.98) 0%, rgba(17,24,39,0.95) 100%);
            border: 1px solid rgba(75,85,99,0.4);
        }

        /* Report specific styles */
        .report-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(255,255,255,0.95) 100%);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(93, 92, 222, 0.2);
            transition: all 0.3s ease;
        }
        .dark .report-card {
            background: linear-gradient(135deg, rgba(31,41,55,0.98) 0%, rgba(17,24,39,0.95) 100%);
            border: 1px solid rgba(93, 92, 222, 0.3);
        }

        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(93, 92, 222, 0.15);
            border-color: rgba(93, 92, 222, 0.4);
        }

        .report-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
        }

        /* Individual Performance Cards styling - CORRIGIDO */
        .individual-performance-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
            min-height: 300px;
        }
        .individual-performance-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(93, 92, 222, 0.15);
            z-index: 10;
            border-color: rgba(93, 92, 222, 0.3) !important;
        }
        .dark .individual-performance-card:hover {
            box-shadow: 0 12px 30px rgba(93, 92, 222, 0.25);
        }

        /* Improved grid for performance cards */
        .performance-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            padding: 4px; /* Pequeno padding para acomodar hover effects */
        }

        /* Print styles */
        @media print {
            .sidebar, .floating-action, .no-print {
                display: none !important;
            }
            .main-content {
                margin-left: 0 !important;
            }
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
            
            .floating-action {
                width: 48px;
                height: 48px;
                bottom: 16px;
                right: 16px;
            }
            
            .period-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .report-grid {
                grid-template-columns: 1fr;
            }

            .performance-cards-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }

        /* Date navigation styles */
        .date-nav-btn {
            transition: all 0.3s ease;
        }
        .date-nav-btn:hover {
            background: rgba(93, 92, 222, 0.1);
            transform: scale(1.1);
        }
        .date-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .date-loading {
            position: relative;
        }
        .date-loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 16px;
            height: 16px;
            margin: -8px 0 0 -8px;
            border: 2px solid #5D5CDE;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        /* Frente Type Indicator */
        .front-type-badge {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 10px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }
        .front-type-own {
            background: #10B981;
            color: white;
        }
        .front-type-third {
            background: #F59E0B;
            color: white;
        }

        /* Enhanced validation styles */
        .validation-success {
            animation: validationSuccess 0.5s ease-in-out;
        }
        .validation-error {
            animation: validationError 0.5s ease-in-out;
        }

        @keyframes validationSuccess {
            0% { background-color: rgba(16, 185, 129, 0.1); }
            50% { background-color: rgba(16, 185, 129, 0.3); }
            100% { background-color: transparent; }
        }

        @keyframes validationError {
            0% { background-color: rgba(239, 68, 68, 0.1); }
            50% { background-color: rgba(239, 68, 68, 0.3); }
            100% { background-color: transparent; }
        }

        /* Period status indicators */
        .period-status-empty {
            background: #f3f4f6;
            color: #6b7280;
        }
        .period-status-partial {
            background: #fef3c7;
            color: #d97706;
        }
        .period-status-complete {
            background: #d1fae5;
            color: #059669;
        }
        .dark .period-status-empty {
            background: #374151;
            color: #9ca3af;
        }
        .dark .period-status-partial {
            background: #451a03;
            color: #f59e0b;
        }
        .dark .period-status-complete {
            background: #064e3b;
            color: #10b981;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <!-- Enhanced Loading Screen -->
    <div id="app-loader" class="fixed inset-0 bg-gradient-to-br from-white via-gray-50 to-gray-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-700 z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="relative mb-8">
                <div class="w-24 h-24 border-4 border-primary/20 rounded-full"></div>
                <div class="w-24 h-24 border-4 border-primary border-t-transparent rounded-full animate-spin absolute top-0"></div>
                <div class="absolute inset-0 flex items-center justify-center">
                    <div class="w-8 h-8 bg-primary rounded-full animate-pulse"></div>
                </div>
            </div>
            <div class="text-3xl font-bold text-gray-700 dark:text-gray-300 mb-2">
                GGOMES-LOG <span class="text-primary animate-pulse">v8.3</span>
            </div>
            <div class="text-sm text-gray-500 dark:text-gray-400 mb-4">
                ENTREGA 24h APRIMORADA + ANÁLISE INDIVIDUAL POR FRENTE
            </div>
            <div class="flex items-center justify-center space-x-1 mb-4">
                <span class="text-sm text-gray-600 dark:text-gray-400">Inicializando</span>
                <span class="loading-dots text-primary"></span>
            </div>
            <div class="w-80 bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden">
                <div id="loading-progress" class="bg-gradient-to-r from-primary via-primary-500 to-primary-600 h-2 rounded-full transition-all duration-500" style="width: 0%"></div>
            </div>
            <div class="mt-4 text-xs text-gray-500 dark:text-gray-400">
                <span id="loading-status">Carregando componentes...</span>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container relative">
        <!-- Enhanced Sidebar -->
        <aside id="sidebar" class="fixed left-0 top-0 h-full w-72 glass shadow-2xl transform -translate-x-full sidebar-transition z-40 border-r border-gray-200/50 dark:border-gray-700/50">
            <div class="flex flex-col h-full">
                <!-- Enhanced Header -->
                <div class="p-6 border-b border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <div class="w-12 h-12 bg-gradient-to-br from-primary via-primary-500 to-primary-600 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg transform transition-transform hover:scale-105 hover:rotate-6">
                                GG
                            </div>
                            <div class="absolute -top-1 -right-1 w-4 h-4 bg-success rounded-full border-2 border-white dark:border-gray-800 animate-pulse"></div>
                        </div>
                        <div>
                            <h1 class="font-bold text-xl text-gray-900 dark:text-white">GGOMES-LOG</h1>
                            <p class="text-xs text-gray-500 dark:text-gray-400 flex items-center">
                                <span class="status-indicator status-success"></span>
                                v8.3 + ENTREGA 24h APRIMORADA
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Navigation -->
                <nav class="flex-1 px-4 py-6 space-y-3 overflow-y-auto">
                    <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider px-4 mb-4">
                        Menu Principal
                    </div>
                    
                    <a href="#" class="nav-link active" data-page="dashboard">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                        </svg>
                        <span>Dashboard</span>
                        <div class="ml-auto">
                            <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                        </div>
                    </a>

                    <a href="#" class="nav-link" data-page="entrega-hora">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span>Entrega 24h</span>
                        <div class="ml-auto text-xs bg-green-500/20 text-green-600 dark:text-green-400 px-2 py-1 rounded-full">
                            <span class="animate-pulse">NOVO</span>
                        </div>
                    </a>

                    <a href="#" class="nav-link" data-page="frentes-config">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <span>Config. Frentes</span>
                        <div class="ml-auto">
                            <span class="text-xs text-success font-medium animate-pulse">FIXED</span>
                        </div>
                    </a>

                    <a href="#" class="nav-link" data-page="analytics">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        <span>Analytics Avançado</span>
                        <div class="ml-auto">
                            <span class="text-xs text-success font-medium animate-pulse">PRO</span>
                        </div>
                    </a>

                    <a href="#" class="nav-link" data-page="metas">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <span>Metas e KPIs</span>
                        <div class="ml-auto">
                            <div class="w-2 h-2 bg-warning rounded-full animate-pulse"></div>
                        </div>
                    </a>

                    <a href="#" class="nav-link" data-page="historico">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span>Histórico</span>
                    </a>

                    <a href="#" class="nav-link" data-page="relatorios">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span>Relatórios</span>
                        <div class="ml-auto">
                            <span class="text-xs text-success font-medium animate-pulse">NEW</span>
                        </div>
                    </a>

                    <div class="pt-6 mt-6 border-t border-gray-200/50 dark:border-gray-700/50">
                        <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider px-4 mb-4">
                            Sistema
                        </div>
                        
                        <a href="#" class="nav-link" data-page="backup">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
                            </svg>
                            <span>Backup & Sync</span>
                            <div class="ml-auto">
                                <div id="sync-status" class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                            </div>
                        </a>
                        
                        <a href="#" class="nav-link" data-page="configuracoes">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            <span>Configurações</span>
                        </a>
                    </div>
                </nav>

                <!-- Enhanced User Profile -->
                <div class="p-4 border-t border-gray-200/50 dark:border-gray-700/50">
                    <div class="flex items-center space-x-3 p-4 rounded-xl glass hover:bg-white/20 dark:hover:bg-gray-700/20 transition-all duration-300 cursor-pointer group">
                        <div class="relative">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 via-purple-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold shadow-lg group-hover:scale-105 transition-transform">
                                GG
                            </div>
                            <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-success rounded-full border-2 border-white dark:border-gray-800 animate-pulse"></div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="font-semibold text-gray-900 dark:text-white truncate">Gutemberg Gomes</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400 truncate">Gerente de Operações</p>
                            <div class="flex items-center mt-1">
                                <div class="w-2 h-2 bg-success rounded-full mr-2 animate-pulse"></div>
                                <span class="text-xs text-success">Online</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Sidebar Overlay -->
        <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-30 hidden transition-all duration-300"></div>

        <!-- Main Content Area -->
        <div class="main-content transition-all duration-500 ease-in-out">
            <!-- Enhanced Header -->
            <header class="sticky top-0 z-20 glass border-b border-gray-200/50 dark:border-gray-700/50">
                <div class="px-4 sm:px-6 lg:px-8">
                    <div class="flex items-center justify-between h-16">
                        <!-- Left Section -->
                        <div class="flex items-center space-x-4">
                            <button id="sidebar-toggle" class="p-2 rounded-xl text-gray-500 hover:text-gray-700 hover:bg-white/50 dark:hover:bg-gray-700/50 focus:outline-none focus-ring transition-all duration-300">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                                </svg>
                            </button>

                            <!-- Enhanced Date Navigation -->
                            <div class="flex items-center space-x-2 glass rounded-xl p-2">
                                <button id="prev-date" class="date-nav-btn p-2 rounded-lg hover:bg-white/50 dark:hover:bg-gray-600/50 transition-all duration-300 tooltip" data-tooltip="Dia anterior (Alt + ←)">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                    </svg>
                                </button>
                                
                                <button id="date-picker" class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-white/50 dark:hover:bg-gray-600/50 rounded-lg transition-all duration-300">
                                    <span id="current-date-display" class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                        </svg>
                                        <span id="date-text">Hoje</span>
                                    </span>
                                </button>
                                
                                <button id="next-date" class="date-nav-btn p-2 rounded-lg hover:bg-white/50 dark:hover:bg-gray-600/50 transition-all duration-300 tooltip" data-tooltip="Próximo dia (Alt + →)">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                    </svg>
                                </button>

                                <!-- Date loading indicator -->
                                <div id="date-loading-indicator" class="date-loading w-4 h-4 hidden"></div>
                            </div>

                            <!-- Live Status Indicators -->
                            <div class="hidden lg:flex items-center space-x-4">
                                <div class="flex items-center space-x-2 text-sm">
                                    <div class="status-indicator status-success"></div>
                                    <span class="text-gray-600 dark:text-gray-400">Sistema Online</span>
                                </div>
                                <div class="flex items-center space-x-2 text-sm">
                                    <div id="auto-save-indicator" class="status-indicator status-info"></div>
                                    <span class="text-gray-600 dark:text-gray-400">Auto-save Ativo</span>
                                </div>
                                <div class="flex items-center space-x-2 text-sm live-data">
                                    <div class="status-indicator status-success"></div>
                                    <span class="text-gray-600 dark:text-gray-400">ENTREGA 24h v8.3</span>
                                </div>
                            </div>
                        </div>

                        <!-- Right Section -->
                        <div class="flex items-center space-x-3">
                            <!-- Quick Stats -->
                            <div class="hidden xl:flex items-center space-x-4 text-sm">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-primary rounded-full animate-pulse"></div>
                                    <span class="text-gray-600 dark:text-gray-400">
                                        <span id="header-total-delivered">0</span>t entregue
                                    </span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-danger rounded-full animate-pulse"></div>
                                    <span class="text-gray-600 dark:text-gray-400">
                                        <span id="header-missing">0</span>t devedor
                                    </span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-success rounded-full animate-pulse"></div>
                                    <span class="text-gray-600 dark:text-gray-400">
                                        <span id="header-efficiency">0</span>% eficiência
                                    </span>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-orange-500 rounded-full animate-pulse"></div>
                                    <span class="text-gray-600 dark:text-gray-400">
                                        <span id="header-trucks-hour">0</span> cam/h TOTAL
                                    </span>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex items-center space-x-2">
                                <!-- Search -->
                                <button id="search-trigger" class="p-2 rounded-xl text-gray-500 hover:text-gray-700 hover:bg-white/50 dark:hover:bg-gray-700/50 transition-all duration-300 tooltip relative" data-tooltip="Busca rápida (Ctrl + K)">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                    </svg>
                                </button>

                                <!-- Notifications -->
                                <button id="notifications-trigger" class="p-2 rounded-xl text-gray-500 hover:text-gray-700 hover:bg-white/50 dark:hover:bg-gray-700/50 transition-all duration-300 tooltip relative" data-tooltip="Notificações">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                                    </svg>
                                    <div id="notification-badge" class="notification-badge">0</div>
                                </button>

                                <!-- Theme Toggle -->
                                <button id="theme-toggle" class="p-2 rounded-xl text-gray-500 hover:text-gray-700 hover:bg-white/50 dark:hover:bg-gray-700/50 transition-all duration-300 tooltip" data-tooltip="Alternar tema (Ctrl + D)">
                                    <svg id="sun-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                                    </svg>
                                    <svg id="moon-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                                    </svg>
                                </button>

                                <!-- Save Button -->
                                <button id="save-data" class="p-2 rounded-xl bg-gradient-to-r from-primary to-primary-600 text-white hover:from-primary-600 hover:to-primary-700 transition-all duration-300 tooltip shadow-lg hover:shadow-xl transform hover:scale-105" data-tooltip="Salvar dados (Ctrl + S)">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Dynamic Content Area -->
            <main class="flex-1 p-6 overflow-auto">
                <!-- Dashboard Content -->
                <div id="dashboard-content" class="page-content">
                    <!-- Quick Actions Bar -->
                    <div class="mb-6 glass rounded-xl p-4">
                        <div class="flex flex-wrap items-center justify-between gap-4">
                            <div class="flex items-center space-x-4">
                                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Dashboard Principal - v8.3 ENTREGA 24h APRIMORADA + ANÁLISE INDIVIDUAL</h2>
                                <div class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400">
                                    <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                                    <span>✅ Interface Otimizada + Múltiplos Modos de Entrada</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button id="refresh-dashboard" class="flex items-center px-3 py-2 text-sm font-medium bg-white/50 dark:bg-gray-700/50 hover:bg-white dark:hover:bg-gray-600 rounded-lg transition-all duration-300 group">
                                    <svg class="w-4 h-4 mr-2 group-hover:animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                    Atualizar
                                </button>
                                <button id="export-dashboard" class="flex items-center px-3 py-2 text-sm font-medium bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-all duration-300">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                    Exportar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Stats Cards with Own/Third Party Breakdown -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-8 gap-6 mb-8">
                        <!-- Total Delivered Card -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Total Entregue (24h)</h3>
                                    <p class="text-3xl font-bold text-gray-900 dark:text-white live-data" id="total-delivered">0.0 t</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm text-primary mr-2" id="delivery-trend">Calculando...</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">vs meta</span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg hover:animate-float">
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                        </svg>
                                    </div>
                                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-success rounded-full flex items-center justify-center animate-bounce" id="delivery-status">
                                        <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Meta Todas Frentes</span>
                                    <span class="font-medium" id="delivery-percentage">0%</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill bg-gradient-to-r from-blue-500 to-blue-600" style="width: 0%" id="delivery-progress"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Own Fronts Delivered -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Frentes Próprias</h3>
                                    <p class="text-3xl font-bold text-success live-data" id="own-delivered">0.0 t</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm text-success mr-2" id="own-trend">Calculando...</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">entregue</span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg hover:animate-pulse">
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                        </svg>
                                    </div>
                                    <div class="front-type-badge front-type-own">P</div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">vs Potencial Próprio</span>
                                    <span class="font-medium text-success" id="own-efficiency">0%</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill bg-gradient-to-r from-green-500 to-green-600" style="width: 0%" id="own-progress"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Third Party Fronts Delivered -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Frentes Terceiras</h3>
                                    <p class="text-3xl font-bold text-warning live-data" id="third-delivered">0.0 t</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm text-warning mr-2" id="third-trend">Calculando...</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">entregue</span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <div class="w-16 h-16 bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl flex items-center justify-center shadow-lg hover:animate-pulse">
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                                        </svg>
                                    </div>
                                    <div class="front-type-badge front-type-third">T</div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">vs Potencial Terceiro</span>
                                    <span class="font-medium text-warning" id="third-efficiency">0%</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill bg-gradient-to-r from-orange-500 to-orange-600" style="width: 0%" id="third-progress"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Missing Delivery Card (Saldo Devedor Total) -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Saldo Devedor Total</h3>
                                    <p class="text-3xl font-bold text-danger live-data" id="total-missing">0.0 t</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm text-danger mr-2" id="missing-trend">Calculando...</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">vs potencial</span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <div class="w-16 h-16 bg-gradient-to-br from-red-500 to-red-600 rounded-2xl flex items-center justify-center shadow-lg hover:animate-pulse">
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                        </svg>
                                    </div>
                                    <div class="absolute -top-2 -right-2 w-6 h-6 bg-warning rounded-full flex items-center justify-center animate-pulse" id="missing-status">
                                        <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">vs Potencial Usado</span>
                                    <span class="font-medium text-danger" id="missing-percentage">0%</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill bg-gradient-to-r from-red-500 to-red-600" style="width: 0%" id="missing-progress"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Own Fronts Missing -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Devedor Próprias</h3>
                                    <p class="text-3xl font-bold text-red-600 live-data" id="own-missing">0.0 t</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm text-red-600 mr-2" id="own-missing-trend">-</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">não entregue</span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <div class="w-16 h-16 bg-gradient-to-br from-red-600 to-red-700 rounded-2xl flex items-center justify-center shadow-lg hover:animate-pulse">
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </div>
                                    <div class="front-type-badge front-type-own">P</div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">% do Potencial Próprio</span>
                                    <span class="font-medium text-red-600" id="own-missing-percentage">0%</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill bg-gradient-to-r from-red-600 to-red-700" style="width: 0%" id="own-missing-progress"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Third Party Missing -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Devedor Terceiras</h3>
                                    <p class="text-3xl font-bold text-red-600 live-data" id="third-missing">0.0 t</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm text-red-600 mr-2" id="third-missing-trend">-</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">não entregue</span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <div class="w-16 h-16 bg-gradient-to-br from-red-600 to-red-700 rounded-2xl flex items-center justify-center shadow-lg hover:animate-pulse">
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"/>
                                        </svg>
                                    </div>
                                    <div class="front-type-badge front-type-third">T</div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">% do Potencial Terceiro</span>
                                    <span class="font-medium text-red-600" id="third-missing-percentage">0%</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill bg-gradient-to-r from-red-600 to-red-700" style="width: 0%" id="third-missing-progress"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Efficiency Card -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Eficiência Real</h3>
                                    <p class="text-3xl font-bold text-gray-900 dark:text-white live-data" id="overall-efficiency">0%</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm" id="efficiency-trend">Só horas c/ dados</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">vs potencial</span>
                                    </div>
                                </div>
                                <div class="relative">
                                    <svg class="w-16 h-16 transform -rotate-90" viewBox="0 0 36 36">
                                        <path class="text-gray-300 dark:text-gray-600" stroke="currentColor" stroke-width="3" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                        <path id="efficiency-circle" class="text-green-500" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"></path>
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <svg class="w-6 h-6 text-green-500 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Horas Com Dados</span>
                                    <span class="font-medium" id="efficiency-status">Calculando</span>
                                </div>
                            </div>
                        </div>

                        <!-- Average Trucks per Hour Card -->
                        <div class="data-card interactive rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-sm font-medium text-gray-500 dark:text-gray-400 mb-1">Total Caminhões/Hora</h3>
                                    <p class="text-3xl font-bold text-gray-900 dark:text-white live-data" id="avg-trucks-hour">0.0</p>
                                    <div class="flex items-center mt-2">
                                        <span class="text-sm" id="trucks-trend">TOTAL todas frentes</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400 ml-2">por hora ativa</span>
                                    </div>
                                </div>
                                <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg hover:animate-pulse">
                                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Períodos Ativos</span>
                                    <span class="font-medium" id="active-periods-count">0</span>
                                </div>
                                <div class="efficiency-bar">
                                    <div class="efficiency-fill bg-gradient-to-r from-purple-500 to-purple-600" style="width: 0%" id="trucks-progress"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Charts Section -->
                    <div class="grid grid-cols-1 xl:grid-cols-3 gap-6 mb-8">
                        <!-- Main Performance Chart -->
                        <div class="xl:col-span-2 glass rounded-2xl p-6 shadow-xl">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 space-y-4 sm:space-y-0">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">Performance vs Potencial</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Cálculo CORRIGIDO: Densidade × Viagens (SEM multiplicador)</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <div class="flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                                        <button class="chart-period-btn active px-3 py-2 text-xs font-medium rounded-md bg-primary text-white transition-all duration-300" data-period="day">Hoje</button>
                                        <button class="chart-period-btn px-3 py-2 text-xs font-medium rounded-md text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-all duration-300" data-period="week">7 Dias</button>
                                        <button class="chart-period-btn px-3 py-2 text-xs font-medium rounded-md text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-all duration-300" data-period="month">30 Dias</button>
                                    </div>
                                </div>
                            </div>
                            <div class="chart-container relative">
                                <canvas id="performance-chart"></canvas>
                                <div id="chart-loading" class="absolute inset-0 flex items-center justify-center bg-white/80 dark:bg-gray-800/80 rounded-xl hidden">
                                    <div class="text-center">
                                        <div class="w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-2"></div>
                                        <span class="text-sm text-gray-600 dark:text-gray-400">Atualizando dados...</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Front Efficiency Chart -->
                        <div class="glass rounded-2xl p-6 shadow-xl">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-900 dark:text-white">Eficiência por Frente</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Performance real vs potencial</p>
                                </div>
                                <button class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="chart-container">
                                <canvas id="front-efficiency-chart"></canvas>
                            </div>
                            <div class="mt-4 space-y-2">
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Melhor performance</span>
                                    <span class="font-semibold text-success animate-pulse" id="best-front">Calculando...</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-gray-500 dark:text-gray-400">Precisa atenção</span>
                                    <span class="font-semibold text-warning animate-pulse" id="attention-front">Calculando...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- NEW: Individual Front Performance Analysis -->
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8">
                        <!-- Individual Front Comparison Chart -->
                        <div class="glass rounded-2xl p-6 shadow-xl">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 space-y-4 sm:space-y-0">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">Análise Individual por Frente</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Entregue vs Potencial vs Meta - Separado por Tipo</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <select id="front-filter" class="px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base">
                                        <option value="all">Todas as Frentes</option>
                                        <option value="own">Apenas Próprias</option>
                                        <option value="third">Apenas Terceiras</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="individual-performance-chart"></canvas>
                            </div>
                        </div>

                        <!-- Timeline Performance Chart -->
                        <div class="glass rounded-2xl p-6 shadow-xl">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6 space-y-4 sm:space-y-0">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">Rendimento por Período</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Entrega ao longo do dia - Por frente</p>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <select id="timeline-front-filter" class="px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-base">
                                        <option value="all">Todas</option>
                                    </select>
                                </div>
                            </div>
                            <div class="chart-container">
                                <canvas id="timeline-performance-chart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Front Performance Cards - LAYOUT CORRIGIDO -->
                    <div class="glass rounded-2xl p-6 shadow-xl mb-8">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="text-xl font-bold text-gray-900 dark:text-white">Ranking de Performance Individual - CORRIGIDO</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Análise detalhada de cada frente com métricas comparativas</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button id="sort-by-efficiency" class="sort-btn active px-3 py-2 text-xs font-medium rounded-lg bg-primary text-white transition-all duration-300">Eficiência</button>
                                <button id="sort-by-delivery" class="sort-btn px-3 py-2 text-xs font-medium rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-300">Entregue</button>
                                <button id="sort-by-trips" class="sort-btn px-3 py-2 text-xs font-medium rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-300">Viagens</button>
                            </div>
                        </div>
                        <!-- Grid com layout corrigido para evitar sobreposição -->
                        <div id="individual-performance-cards" class="performance-cards-grid">
                            <!-- Performance cards will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Enhanced Performance Table -->
                    <div class="glass rounded-2xl shadow-xl overflow-hidden">
                        <div class="p-6 border-b border-gray-200/50 dark:border-gray-700/50">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 dark:text-white">Detalhamento por Frente - v8.3 INTERFACE APRIMORADA + ANÁLISE INDIVIDUAL</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">✅ CORRETO: Entrega = Densidade × Viagens (SEM multiplicador extra)</p>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="flex items-center space-x-2">
                                        <input type="text" id="table-search" placeholder="Buscar frente..." class="px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus-ring text-base">
                                    </div>
                                    <button id="table-export" class="flex items-center px-3 py-2 text-sm font-medium bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-all duration-300">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                        </svg>
                                        Exportar
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200/50 dark:divide-gray-700/50">
                                <thead class="bg-gray-50/50 dark:bg-gray-700/50">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:text-gray-700 dark:hover:text-gray-100 transition-colors" data-sort="front">
                                            <div class="flex items-center space-x-1">
                                                <span>Frente</span>
                                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"/>
                                                </svg>
                                            </div>
                                        </th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Entregue (24h)</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-danger uppercase tracking-wider">Não Entregue</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Potencial Usado</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Meta Diária</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Eficiência Real</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Viagens</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Cam/Hora</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="performance-table" class="bg-white/50 dark:bg-gray-800/50 divide-y divide-gray-200/50 dark:divide-gray-700/50">
                                    <!-- Real data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        <div class="px-6 py-4 border-t border-gray-200/50 dark:border-gray-700/50 bg-gray-50/50 dark:bg-gray-700/50">
                            <div class="flex items-center justify-between">
                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                    Mostrando <span id="table-showing">0-0</span> de <span id="table-total">0</span> frentes
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button class="px-3 py-1 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                        Anterior
                                    </button>
                                    <span class="px-3 py-1 text-sm bg-primary text-white rounded-md">1</span>
                                    <button class="px-3 py-1 text-sm bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors">
                                        Próximo
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Entrega por Hora Content -->
                <div id="entrega-hora-content" class="page-content hidden">
                    <div class="mb-6">
                        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center space-y-4 lg:space-y-0">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Controle de Entrega 24h (06:00-06:00)</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-2">✅ INTERFACE APRIMORADA: Múltiplos modos de entrada + Validação em tempo real</p>
                                <div class="flex items-center mt-3 space-x-4 text-sm">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                        <span class="text-gray-600 dark:text-gray-400">Sistema Online</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 bg-blue-500 rounded-full animate-pulse"></div>
                                        <span class="text-gray-600 dark:text-gray-400" id="period-status-indicator">Pronto para entrada de dados</span>
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-wrap gap-3">
                                <button id="copy-previous-period" class="flex items-center bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md tooltip" data-tooltip="Copiar dados do período anterior">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                    </svg>
                                    Copiar Anterior
                                </button>
                                <button id="bulk-input-mode" class="flex items-center bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md tooltip" data-tooltip="Entrada rápida em lote">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                    </svg>
                                    Entrada Rápida
                                </button>
                                <button id="manage-fronts" class="flex items-center bg-white/80 dark:bg-gray-700/80 hover:bg-white dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                    </svg>
                                    Gerenciar Frentes
                                </button>
                                <button id="clear-period" class="flex items-center bg-red-500/10 hover:bg-red-500/20 text-red-600 dark:text-red-400 py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                    Limpar Período
                                </button>
                                <button id="export-period" class="flex items-center bg-primary/10 hover:bg-primary/20 text-primary py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4-4m0 0L8 8m4-4v12"/>
                                    </svg>
                                    Exportar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Quick Stats Bar -->
                    <div class="mb-6 glass rounded-xl p-4">
                        <div class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-8 gap-4">
                            <div class="text-center p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                                <div class="text-lg font-bold text-blue-600 dark:text-blue-400" id="quick-total-periods">0</div>
                                <div class="text-xs text-blue-600 dark:text-blue-400">Períodos Ativos</div>
                            </div>
                            <div class="text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg">
                                <div class="text-lg font-bold text-green-600 dark:text-green-400" id="quick-total-delivery">0.0t</div>
                                <div class="text-xs text-green-600 dark:text-green-400">Total Entregue</div>
                            </div>
                            <div class="text-center p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                                <div class="text-lg font-bold text-purple-600 dark:text-purple-400" id="quick-total-trips">0</div>
                                <div class="text-xs text-purple-600 dark:text-purple-400">Total Viagens</div>
                            </div>
                            <div class="text-center p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                                <div class="text-lg font-bold text-orange-600 dark:text-orange-400" id="quick-avg-density">0.0</div>
                                <div class="text-xs text-orange-600 dark:text-orange-400">Densidade Média</div>
                            </div>
                            <div class="text-center p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg">
                                <div class="text-lg font-bold text-indigo-600 dark:text-indigo-400" id="quick-total-potential">0.0t</div>
                                <div class="text-xs text-indigo-600 dark:text-indigo-400">Potencial Usado</div>
                            </div>
                            <div class="text-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg">
                                <div class="text-lg font-bold text-red-600 dark:text-red-400" id="quick-total-missing">0.0t</div>
                                <div class="text-xs text-red-600 dark:text-red-400">Não Entregue</div>
                            </div>
                            <div class="text-center p-3 bg-teal-50 dark:bg-teal-900/20 rounded-lg">
                                <div class="text-lg font-bold text-teal-600 dark:text-teal-400" id="quick-overall-efficiency">0%</div>
                                <div class="text-xs text-teal-600 dark:text-teal-400">Eficiência Geral</div>
                            </div>
                            <div class="text-center p-3 bg-pink-50 dark:bg-pink-900/20 rounded-lg">
                                <div class="text-lg font-bold text-pink-600 dark:text-pink-400" id="quick-trucks-hour">0.0</div>
                                <div class="text-xs text-pink-600 dark:text-pink-400">Cam/Hora</div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Period Selection with Visual Progress -->
                    <div class="mb-6">
                        <div class="glass rounded-xl p-4">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Períodos do Dia - Ciclo Completo 24h</h3>
                                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Selecione um período para inserir dados. Clique em "Entrada Rápida" para modo avançado.</p>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <div class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400">
                                        <div class="w-2 h-2 bg-success rounded-full animate-pulse"></div>
                                        <span>Auto-save ativo</span>
                                    </div>
                                    <button id="period-navigation-help" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all tooltip" data-tooltip="Ajuda de navegação">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="period-grid" id="time-periods-container">
                                <!-- Time period cards will be generated by JavaScript -->
                            </div>
                            <!-- Period Progress Bar -->
                            <div class="mt-4 bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden">
                                <div class="bg-gradient-to-r from-primary via-primary-500 to-primary-600 h-2 transition-all duration-1000 ease-out" style="width: 0%" id="period-progress-bar"></div>
                            </div>
                            <div class="mt-2 text-xs text-gray-500 dark:text-gray-400 text-center">
                                <span id="period-progress-text">0 de 12 períodos com dados</span>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Period Content Container -->
                    <div id="time-period-content" class="animate-fade-in">
                        <!-- Active Period Form with Improved Layout -->
                        <div class="glass rounded-2xl shadow-xl overflow-hidden">
                            <!-- Period Header -->
                            <div class="bg-gradient-to-r from-primary/10 via-primary/5 to-transparent p-6 border-b border-gray-200/50 dark:border-gray-700/50">
                                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                                    <div>
                                        <h3 class="text-2xl font-bold text-gray-900 dark:text-white" id="period-title">Período: 06:00-08:00</h3>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Digite densidade e viagens para cada hora. A entrega é calculada automaticamente.</p>
                                    </div>
                                    <div class="flex flex-wrap items-center gap-4 text-sm">
                                        <div class="flex items-center space-x-2 bg-white/50 dark:bg-gray-800/50 rounded-lg px-3 py-2">
                                            <div class="w-3 h-3 bg-purple-500 rounded-full animate-pulse"></div>
                                            <span class="text-gray-600 dark:text-gray-400">Viagens: <span class="font-bold text-purple-600 dark:text-purple-400" id="period-total-trips">0</span></span>
                                        </div>
                                        <div class="flex items-center space-x-2 bg-white/50 dark:bg-gray-800/50 rounded-lg px-3 py-2">
                                            <div class="w-3 h-3 bg-success rounded-full animate-pulse"></div>
                                            <span class="text-gray-600 dark:text-gray-400">Entrega: <span class="font-bold text-green-600 dark:text-green-400" id="period-total-delivery">0.0t</span></span>
                                        </div>
                                        <div class="flex items-center space-x-2 bg-white/50 dark:bg-gray-800/50 rounded-lg px-3 py-2">
                                            <div class="w-3 h-3 bg-primary rounded-full animate-pulse"></div>
                                            <span class="text-gray-600 dark:text-gray-400">Potencial: <span class="font-bold text-primary" id="period-total-potential">0.0t</span></span>
                                        </div>
                                        <div class="flex items-center space-x-2 bg-white/50 dark:bg-gray-800/50 rounded-lg px-3 py-2">
                                            <div class="w-3 h-3 bg-danger rounded-full animate-pulse"></div>
                                            <span class="text-gray-600 dark:text-gray-400">Devedor: <span class="font-bold text-red-600 dark:text-red-400" id="period-total-missing">0.0t</span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced Data Input Section -->
                            <div class="p-6">
                                <!-- Input Method Selector -->
                                <div class="mb-6 flex items-center justify-between">
                                    <div class="flex bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                                        <button class="input-mode-btn active px-4 py-2 text-sm font-medium rounded-md bg-primary text-white transition-all duration-300" data-mode="table">
                                            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                                            </svg>
                                            Tabela Detalhada
                                        </button>
                                        <button class="input-mode-btn px-4 py-2 text-sm font-medium rounded-md text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-all duration-300" data-mode="cards">
                                            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                                            </svg>
                                            Cartões
                                        </button>
                                        <button class="input-mode-btn px-4 py-2 text-sm font-medium rounded-md text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition-all duration-300" data-mode="bulk">
                                            <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                            </svg>
                                            Entrada Rápida
                                        </button>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <button id="validate-all-inputs" class="flex items-center px-3 py-2 text-sm bg-green-100 hover:bg-green-200 dark:bg-green-900/20 dark:hover:bg-green-800/30 text-green-700 dark:text-green-400 rounded-lg transition-all">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                            </svg>
                                            Validar Tudo
                                        </button>
                                        <button id="clear-period-inputs" class="flex items-center px-3 py-2 text-sm bg-red-100 hover:bg-red-200 dark:bg-red-900/20 dark:hover:bg-red-800/30 text-red-700 dark:text-red-400 rounded-lg transition-all">
                                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                            </svg>
                                            Limpar
                                        </button>
                                    </div>
                                </div>

                                <!-- Table Input Mode -->
                                <div id="table-input-mode" class="input-mode-content">
                                    <div class="overflow-x-auto rounded-xl border border-gray-200 dark:border-gray-700">
                                        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                            <thead class="bg-gray-50 dark:bg-gray-800">
                                                <tr>
                                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Frente</th>
                                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="hour1-header">06:00</th>
                                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider" id="hour2-header">07:00</th>
                                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Total Período</th>
                                                    <th class="px-6 py-4 text-left text-xs font-semibold text-danger uppercase tracking-wider">Saldo Devedor</th>
                                                    <th class="px-6 py-4 text-left text-xs font-semibold text-gray-500 dark:text-gray-300 uppercase tracking-wider">Eficiência</th>
                                                </tr>
                                            </thead>
                                            <tbody id="period-data-table" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                                                <!-- Dynamic content will be generated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Cards Input Mode -->
                                <div id="cards-input-mode" class="input-mode-content hidden">
                                    <div id="period-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        <!-- Dynamic cards will be generated here -->
                                    </div>
                                </div>

                                <!-- Bulk Input Mode -->
                                <div id="bulk-input-mode-content" class="input-mode-content hidden">
                                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                        <div class="space-y-4">
                                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Entrada Rápida - Primeira Hora</h4>
                                            <div class="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Densidade Padrão (t/viag)</label>
                                                    <input type="number" id="bulk-density-hour1" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary text-base" placeholder="65.0" step="0.1">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Viagens por Frente</label>
                                                    <input type="number" id="bulk-trips-hour1" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary text-base" placeholder="10" step="1">
                                                </div>
                                            </div>
                                            <button id="apply-bulk-hour1" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition-colors">
                                                Aplicar para Primeira Hora
                                            </button>
                                        </div>
                                        <div class="space-y-4">
                                            <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Entrada Rápida - Segunda Hora</h4>
                                            <div class="grid grid-cols-2 gap-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Densidade Padrão (t/viag)</label>
                                                    <input type="number" id="bulk-density-hour2" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary text-base" placeholder="65.0" step="0.1">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Viagens por Frente</label>
                                                    <input type="number" id="bulk-trips-hour2" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary text-base" placeholder="10" step="1">
                                                </div>
                                            </div>
                                            <button id="apply-bulk-hour2" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors">
                                                Aplicar para Segunda Hora
                                            </button>
                                        </div>
                                    </div>
                                    <div class="mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-700">
                                        <div class="flex items-start space-x-3">
                                            <svg class="w-5 h-5 text-yellow-600 dark:text-yellow-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                            </svg>
                                            <div>
                                                <h5 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Dica de Entrada Rápida</h5>
                                                <p class="text-sm text-yellow-700 dark:text-yellow-300 mt-1">Use este modo para aplicar valores padrão a todas as frentes de uma vez. Depois ajuste individualmente se necessário.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced Period Summary -->
                            <div class="bg-gradient-to-r from-primary/5 via-transparent to-primary/5 p-6 border-t border-gray-200/50 dark:border-gray-700/50">
                                <div class="flex items-center justify-between mb-4">
                                    <h4 class="text-lg font-bold text-primary" id="period-summary-title">Resumo do Período 06:00-08:00</h4>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 rounded-full" id="period-status-indicator-color"></div>
                                        <span class="text-sm font-medium" id="period-status-text">Aguardando dados</span>
                                    </div>
                                </div>
                                <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4">
                                    <div class="text-center p-4 bg-white/70 dark:bg-gray-800/70 rounded-xl border border-green-200 dark:border-green-700">
                                        <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="summary-delivered">0.0t</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Total Entregue</div>
                                        <div class="mt-1 h-1 bg-green-200 dark:bg-green-800 rounded-full overflow-hidden">
                                            <div class="h-full bg-green-500 transition-all duration-500" style="width: 0%" id="summary-delivered-progress"></div>
                                        </div>
                                    </div>
                                    <div class="text-center p-4 bg-white/70 dark:bg-gray-800/70 rounded-xl border border-purple-200 dark:border-purple-700">
                                        <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="summary-trips">0</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Total Viagens</div>
                                        <div class="mt-1 h-1 bg-purple-200 dark:bg-purple-800 rounded-full overflow-hidden">
                                            <div class="h-full bg-purple-500 transition-all duration-500" style="width: 0%" id="summary-trips-progress"></div>
                                        </div>
                                    </div>
                                    <div class="text-center p-4 bg-white/70 dark:bg-gray-800/70 rounded-xl border border-blue-200 dark:border-blue-700">
                                        <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="summary-efficiency">0%</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Eficiência</div>
                                        <div class="mt-1 h-1 bg-blue-200 dark:bg-blue-800 rounded-full overflow-hidden">
                                            <div class="h-full bg-blue-500 transition-all duration-500" style="width: 0%" id="summary-efficiency-progress"></div>
                                        </div>
                                    </div>
                                    <div class="text-center p-4 bg-white/70 dark:bg-gray-800/70 rounded-xl border border-indigo-200 dark:border-indigo-700">
                                        <div class="text-2xl font-bold text-indigo-600 dark:text-indigo-400" id="summary-potential">0.0t</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Potencial</div>
                                        <div class="mt-1 h-1 bg-indigo-200 dark:bg-indigo-800 rounded-full overflow-hidden">
                                            <div class="h-full bg-indigo-500 transition-all duration-500" style="width: 100%" id="summary-potential-progress"></div>
                                        </div>
                                    </div>
                                    <div class="text-center p-4 bg-white/70 dark:bg-gray-800/70 rounded-xl border border-red-200 dark:border-red-700">
                                        <div class="text-2xl font-bold text-red-600 dark:text-red-400" id="summary-missing">0.0t</div>
                                        <div class="text-sm text-gray-500 dark:text-gray-400">Não Entregue</div>
                                        <div class="mt-1 h-1 bg-red-200 dark:bg-red-800 rounded-full overflow-hidden">
                                            <div class="h-full bg-red-500 transition-all duration-500" style="width: 0%" id="summary-missing-progress"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Configuração de Frentes Content -->
                <div id="frentes-config-content" class="page-content hidden">
                    <div class="mb-6">
                        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center space-y-4 lg:space-y-0">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Configuração de Frentes</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-2">Configure potencial por hora, metas diárias e tipo (Própria/Terceira)</p>
                            </div>
                            <div class="flex flex-wrap gap-3">
                                <button id="add-new-front-config" class="flex items-center bg-primary hover:bg-primary-600 text-white py-2 px-4 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                    </svg>
                                    Nova Frente
                                </button>
                                <button id="import-config" class="flex items-center bg-white/80 dark:bg-gray-700/80 hover:bg-white dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
                                    </svg>
                                    Importar Configuração
                                </button>
                                <button id="export-config" class="flex items-center bg-primary/10 hover:bg-primary/20 text-primary py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4-4m0 0L8 8m4-4v12"/>
                                    </svg>
                                    Exportar
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Configuration Cards Grid -->
                    <div id="fronts-config-grid" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
                        <!-- Configuration cards will be generated by JavaScript -->
                    </div>
                </div>

                <!-- Relatórios Content -->
                <div id="relatorios-content" class="page-content hidden">
                    <div class="mb-6">
                        <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center space-y-4 lg:space-y-0">
                            <div>
                                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">Central de Relatórios</h2>
                                <p class="text-gray-600 dark:text-gray-400 mt-2">Relatórios completos com fórmula corrigida + separação Próprias/Terceiras</p>
                            </div>
                            <div class="flex flex-wrap gap-3">
                                <button id="generate-all-reports" class="flex items-center bg-primary hover:bg-primary-600 text-white py-2 px-4 rounded-xl transition-all duration-300 shadow-lg hover:shadow-xl">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                    </svg>
                                    Gerar Todos
                                </button>
                                <button id="schedule-reports" class="flex items-center bg-white/80 dark:bg-gray-700/80 hover:bg-white dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    Programar
                                </button>
                                <button id="export-reports-config" class="flex items-center bg-primary/10 hover:bg-primary/20 text-primary py-2 px-4 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                    Configurações
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Report Types Grid -->
                    <div class="report-grid mb-8">
                        <!-- Daily Report -->
                        <div class="report-card rounded-2xl p-6 shadow-xl cursor-pointer" data-report="daily">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                                <span class="text-xs bg-blue-100 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 px-2 py-1 rounded-full font-medium">DIÁRIO</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Relatório Diário</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Análise completa do dia com separação Próprias/Terceiras</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Última geração:</span>
                                    <span class="font-medium text-gray-900 dark:text-white" id="daily-last-gen">Nunca</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Formato:</span>
                                    <span class="font-medium text-gray-900 dark:text-white">PDF + CSV</span>
                                </div>
                            </div>
                            <button class="w-full mt-4 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg transition-colors font-medium generate-report-btn" data-type="daily">
                                Gerar Relatório Diário
                            </button>
                        </div>

                        <!-- Performance Report -->
                        <div class="report-card rounded-2xl p-6 shadow-xl cursor-pointer" data-report="performance">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                                    </svg>
                                </div>
                                <span class="text-xs bg-orange-100 dark:bg-orange-900/20 text-orange-600 dark:text-orange-400 px-2 py-1 rounded-full font-medium">PERFORMANCE</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Análise de Performance</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Ranking de frentes, eficiências, separado por tipo</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Fórmula corrigida:</span>
                                    <span class="font-medium text-success">✓ Sim</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Próprias/Terceiras:</span>
                                    <span class="font-medium text-success">✓ Sim</span>
                                </div>
                            </div>
                            <button class="w-full mt-4 bg-orange-500 hover:bg-orange-600 text-white py-2 px-4 rounded-lg transition-colors font-medium generate-report-btn" data-type="performance">
                                Gerar Análise de Performance
                            </button>
                        </div>

                        <!-- Efficiency Report -->
                        <div class="report-card rounded-2xl p-6 shadow-xl cursor-pointer" data-report="efficiency">
                            <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                    </svg>
                                </div>
                                <span class="text-xs bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400 px-2 py-1 rounded-full font-medium">SALDO DEVEDOR</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Relatório de Saldo Devedor</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">Análise detalhada do que não foi entregue por tipo</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Por frente:</span>
                                    <span class="font-medium text-success">✓ Sim</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-gray-500 dark:text-gray-400">Por período:</span>
                                    <span class="font-medium text-success">✓ Sim</span>
                                </div>
                            </div>
                            <button class="w-full mt-4 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg transition-colors font-medium generate-report-btn" data-type="efficiency">
                                Gerar Relatório de Saldo Devedor
                            </button>
                        </div>
                    </div>

                    <!-- Recent Reports Section -->
                    <div class="glass rounded-2xl p-6 shadow-xl">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white">Relatórios Recentes</h3>
                            <button id="clear-reports-history" class="text-sm text-gray-500 hover:text-red-500 transition-colors">
                                Limpar Histórico
                            </button>
                        </div>
                        <div id="recent-reports-list" class="space-y-3">
                            <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                                <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                </svg>
                                <p>Nenhum relatório gerado ainda</p>
                                <p class="text-xs mt-2">Gere seu primeiro relatório usando os cartões acima</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other content sections -->
                <div id="analytics-content" class="page-content hidden">
                    <div class="text-center py-20">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Analytics Avançado</h2>
                        <p class="text-gray-600 dark:text-gray-400">Seção em desenvolvimento com separação Próprias/Terceiras v8.3</p>
                    </div>
                </div>

                <div id="metas-content" class="page-content hidden">
                    <div class="text-center py-20">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Metas e KPIs</h2>
                        <p class="text-gray-600 dark:text-gray-400">Seção em desenvolvimento com eficiência corrigida v8.3</p>
                    </div>
                </div>

                <div id="historico-content" class="page-content hidden">
                    <div class="text-center py-20">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Histórico</h2>
                        <p class="text-gray-600 dark:text-gray-400">Histórico será implementado em breve</p>
                    </div>
                </div>

                <div id="backup-content" class="page-content hidden">
                    <div class="text-center py-20">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Backup & Sincronização</h2>
                        <p class="text-gray-600 dark:text-gray-400">Backup será implementado em breve</p>
                    </div>
                </div>

                <div id="configuracoes-content" class="page-content hidden">
                    <div class="text-center py-20">
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">Configurações</h2>
                        <p class="text-gray-600 dark:text-gray-400">Configurações serão implementadas em breve</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Enhanced Toast Container -->
    <div id="toast-container" class="fixed bottom-6 right-6 z-50 space-y-3 max-w-sm"></div>

    <!-- Enhanced Search Modal -->
    <div id="search-modal" class="fixed inset-0 z-50 hidden">
        <div class="flex items-start justify-center min-h-screen pt-20 px-4">
            <div class="fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity" id="search-backdrop"></div>
            <div class="relative glass rounded-2xl shadow-2xl w-full max-w-2xl border border-white/20 dark:border-gray-700/20">
                <div class="p-6">
                    <div class="flex items-center space-x-4 mb-6">
                        <div class="w-10 h-10 bg-primary/20 rounded-xl flex items-center justify-center">
                            <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                        </div>
                        <input type="text" id="search-input" class="flex-1 text-lg bg-transparent border-none outline-none text-gray-900 dark:text-white placeholder-gray-500 text-base" placeholder="Buscar frentes, períodos, configurações..." autofocus>
                        <button id="close-search" class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    <div id="search-results" class="space-y-2 max-h-96 overflow-y-auto">
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                            <p>Digite para pesquisar...</p>
                            <p class="text-xs mt-2">Use Ctrl+K para busca rápida</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Manage Fronts Modal -->
    <div id="manage-fronts-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="fronts-modal-backdrop"></div>
        <div class="glass rounded-2xl p-8 max-w-lg w-full relative z-10 shadow-2xl border border-white/20 dark:border-gray-700/20 mx-4">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Gerenciar Frentes</h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Adicione ou remova frentes de trabalho</p>
                </div>
                <button id="close-fronts-modal" class="p-2 text-gray-400 hover:text-gray-500 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <div class="mb-6">
                <div class="flex gap-3 mb-4">
                    <input type="text" id="new-front-input" placeholder="Ex: 4010" class="flex-1 px-4 py-3 text-base text-gray-700 dark:text-gray-300 bg-white/50 dark:bg-gray-700/50 border-2 border-gray-300 dark:border-gray-600 rounded-xl focus:outline-none focus:border-primary transition-all">
                    <button id="add-front-btn" class="px-6 py-3 bg-gradient-to-r from-primary to-primary-600 text-white rounded-xl hover:from-primary-600 hover:to-primary-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 font-medium">
                        Adicionar
                    </button>
                </div>
            </div>
            
            <div class="glass rounded-xl overflow-hidden border border-gray-200/50 dark:border-gray-700/50">
                <div class="bg-gray-50/50 dark:bg-gray-700/50 px-4 py-3 border-b border-gray-200/50 dark:border-gray-700/50">
                    <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300">Frentes Atuais</h4>
                </div>
                <ul id="fronts-list" class="divide-y divide-gray-200/50 dark:divide-gray-700/50 max-h-60 overflow-y-auto">
                    <!-- Current fronts will be populated by JavaScript -->
                </ul>
            </div>
        </div>
    </div>

    <!-- Front Configuration Modal -->
    <div id="front-config-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="config-modal-backdrop"></div>
        <div class="glass rounded-2xl p-8 max-w-4xl w-full relative z-10 shadow-2xl border border-white/20 dark:border-gray-700/20 mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-gray-100" id="config-modal-title">Configurar Frente</h3>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Configure potencial por hora, meta diária e tipo</p>
                </div>
                <button id="close-config-modal" class="p-2 text-gray-400 hover:text-gray-500 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-all">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Configuration Tabs -->
            <div class="flex space-x-1 mb-6 bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
                <button class="tab-button active" data-tab="general">Configuração Geral</button>
                <button class="tab-button" data-tab="potential">Potencial por Hora</button>
            </div>

            <!-- General Tab -->
            <div id="general-tab" class="tab-content">
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Tipo de Frente</label>
                            <select id="front-type" class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary transition-all">
                                <option value="own">Própria</option>
                                <option value="third">Terceira</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Meta Diária (toneladas)</label>
                            <input type="number" id="front-daily-goal" class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary transition-all" placeholder="1000" min="0" step="1">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Potencial Padrão por Hora (toneladas)</label>
                            <input type="number" id="front-default-potential" class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary transition-all" placeholder="50" min="0" step="0.1">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Observações</label>
                        <textarea id="front-notes" rows="3" class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary transition-all" placeholder="Observações sobre a frente..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Potential Tab -->
            <div id="potential-tab" class="tab-content hidden">
                <div class="space-y-4">
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold text-gray-900 dark:text-white">Potencial por Hora (24h)</h4>
                        <button id="copy-default-potential" class="px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 rounded-lg transition-colors">
                            Aplicar Padrão para Todas
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-3" id="hourly-potential-grid">
                        <!-- Hourly potential inputs will be generated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-end space-x-3 mt-8 pt-6 border-t border-gray-200/50 dark:border-gray-700/50">
                <button id="cancel-config" class="px-6 py-3 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-xl transition-all duration-300 font-medium">
                    Cancelar
                </button>
                <button id="save-config" class="px-6 py-3 bg-gradient-to-r from-primary to-primary-600 text-white rounded-xl hover:from-primary-600 hover:to-primary-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 font-medium">
                    Salvar Configuração
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay for operations -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="glass rounded-2xl p-8 text-center">
            <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Processando...</p>
            <p class="text-sm text-gray-600 dark:text-gray-400" id="loading-message">Aguarde um momento</p>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="floating-action no-print" id="floating-action" title="Ações rápidas">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
        </svg>
    </div>

    <!-- JavaScript Application with Enhanced 24h Entry System -->
    <script>
        class GGomesLogSystemEnhanced {
            constructor() {
                this.version = '8.3-ENTREGA-24H-APRIMORADA';
                this.state = {
                    currentDate: new Date().toISOString().split('T')[0],
                    currentPage: 'dashboard',
                    activePeriod: '06-08',
                    fronts: ['4001', '4002', '4007', '4009'], // Default fronts
                    
                    // Enhanced input mode state
                    activeInputMode: 'table', // 'table', 'cards', 'bulk'
                    
                    // Data structures for all periods - REAL DATA
                    data: {
                        periods: {},
                        
                        // Front configurations with potential, goals, and TYPE
                        frontConfigs: {
                            // Structure: frontNumber: { type: 'own'|'third', dailyGoal, defaultPotential, hourlyPotential, notes }
                        },
                        
                        // Global goals (calculated from individual front goals)
                        dailyGoals: {
                            delivery: 4000, // Will be sum of all front goals
                            efficiency: 85, // %
                            trips: 1500
                        }
                    },
                    
                    // UI state management
                    ui: {
                        sidebarOpen: false,
                        searchOpen: false,
                        loading: false,
                        unsavedChanges: false,
                        currentConfigFront: null,
                        activeConfigTab: 'general',
                        dateNavigationInProgress: false,
                        periodInputValidation: {}
                    },
                    
                    // Charts storage
                    charts: {},
                    
                    // Input debounce timers
                    debounceTimers: {},
                    
                    // Reports system
                    reports: {
                        history: [],
                        lastGenerated: {},
                        templates: {
                            daily: { name: 'Relatório Diário', format: 'PDF+CSV' },
                            weekly: { name: 'Relatório Semanal', format: 'PDF+Excel' },
                            monthly: { name: 'Relatório Mensal', format: 'PDF+PowerPoint' },
                            performance: { name: 'Análise de Performance', format: 'PDF' },
                            efficiency: { name: 'Relatório de Saldo Devedor', format: 'PDF+CSV' },
                            custom: { name: 'Relatório Customizado', format: 'Configurável' }
                        }
                    },
                    
                    // Configuration
                    config: {
                        autoSaveInterval: 30000, // 30 seconds
                        chartUpdateInterval: 5000, // 5 seconds
                        inputDebounceDelay: 300, // 300ms debounce for inputs
                        maxEfficiency: 100,
                        defaultDensity: 65, // NOT USED in calculation anymore!
                        defaultFrontGoal: 1000, // Default goal per front
                        defaultPotentialPerHour: 50, // Default potential per hour
                        efficiencyTarget: 85, // Default efficiency target
                        notifications: {
                            enabled: true,
                            sound: false,
                            efficiencyAlerts: true
                        },
                        theme: 'auto',
                        uiDensity: 'comfortable'
                    }
                };

                // Time slots configuration - COMPLETE 24h CYCLE (06:00-06:00)
                this.timeSlots = [
                    { period: '06-08', start: '06:00', end: '08:00', label: 'Manhã', hours: ['06:00', '07:00'] },
                    { period: '08-10', start: '08:00', end: '10:00', label: 'Manhã', hours: ['08:00', '09:00'] },
                    { period: '10-12', start: '10:00', end: '12:00', label: 'Manhã', hours: ['10:00', '11:00'] },
                    { period: '12-14', start: '12:00', end: '14:00', label: 'Tarde', hours: ['12:00', '13:00'] },
                    { period: '14-16', start: '14:00', end: '16:00', label: 'Tarde', hours: ['14:00', '15:00'] },
                    { period: '16-18', start: '16:00', end: '18:00', label: 'Tarde', hours: ['16:00', '17:00'] },
                    { period: '18-20', start: '18:00', end: '20:00', label: 'Noite', hours: ['18:00', '19:00'] },
                    { period: '20-22', start: '20:00', end: '22:00', label: 'Noite', hours: ['20:00', '21:00'] },
                    { period: '22-00', start: '22:00', end: '00:00', label: 'Noite', hours: ['22:00', '23:00'] },
                    { period: '00-02', start: '00:00', end: '02:00', label: 'Madrugada', hours: ['00:00', '01:00'] },
                    { period: '02-04', start: '02:00', end: '04:00', label: 'Madrugada', hours: ['02:00', '03:00'] },
                    { period: '04-06', start: '04:00', end: '06:00', label: 'Madrugada', hours: ['04:00', '05:00'] }
                ];

                // Hours for potential configuration (24h)
                this.hours24 = [
                    '06:00', '07:00', '08:00', '09:00', '10:00', '11:00',
                    '12:00', '13:00', '14:00', '15:00', '16:00', '17:00',
                    '18:00', '19:00', '20:00', '21:00', '22:00', '23:00',
                    '00:00', '01:00', '02:00', '03:00', '04:00', '05:00'
                ];

                this.charts = {};
                this.isChartsLibraryLoaded = false;
                this.eventListenersAdded = false;
                
                this.init();
            }

            async init() {
                try {
                    console.log(`🚀 Inicializando GGOMES-LOG v${this.version} - ENTREGA 24h APRIMORADA...`);
                    
                    this.showLoadingProgress(10, 'Carregando bibliotecas...');
                    await this.waitForLibraries();
                    
                    this.showLoadingProgress(25, 'Configurando tema...');
                    this.setupTheme();
                    
                    this.showLoadingProgress(40, 'Carregando dados com interface aprimorada...');
                    this.loadData();
                    
                    this.showLoadingProgress(55, 'Inicializando estrutura de dados 24h...');
                    this.initializeDataStructures();
                    this.initializeFrontConfigs();
                    
                    this.showLoadingProgress(70, 'Configurando interface aprimorada...');
                    this.initializeUI();
                    
                    this.showLoadingProgress(85, 'Criando gráficos com análise individual...');
                    await this.initializeCharts();
                    
                    this.showLoadingProgress(90, 'Configurando eventos aprimorados...');
                    this.setupEventListeners();
                    
                    this.showLoadingProgress(95, 'Finalizando configuração...');
                    this.startPeriodicUpdates();
                    
                    this.showLoadingProgress(100, 'Sistema pronto!');
                    
                    setTimeout(() => {
                        this.hideLoader();
                        this.showToast(`🎉 GGOMES-LOG v${this.version} - ENTREGA 24h COM INTERFACE APRIMORADA!`, 'success');
                        this.updateDateDisplay();
                        this.updateAllRealData();
                        this.updateQuickStats();
                    }, 800);
                    
                } catch (error) {
                    console.error('❌ Erro na inicialização:', error);
                    this.showToast('Erro na inicialização do sistema', 'error');
                    this.hideLoader();
                }
            }

            showLoadingProgress(progress, status) {
                const progressBar = document.getElementById('loading-progress');
                const statusText = document.getElementById('loading-status');
                
                if (progressBar) {
                    progressBar.style.width = `${Math.min(progress, 100)}%`;
                }
                if (statusText) {
                    statusText.textContent = status;
                }
            }

            async waitForLibraries() {
                let attempts = 0;
                const maxAttempts = 100;
                
                while (typeof Chart === 'undefined' && attempts < maxAttempts) {
                    await new Promise(resolve => setTimeout(resolve, 50));
                    attempts++;
                }
                
                if (typeof Chart !== 'undefined') {
                    this.isChartsLibraryLoaded = true;
                    console.log('✅ Chart.js carregado');
                } else {
                    console.warn('⚠️ Chart.js não foi carregado');
                }
            }

            setupTheme() {
                // Apply system preference
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (prefersDark) {
                    document.documentElement.classList.add('dark');
                }
                
                this.updateThemeIcons();
                
                // Listen for system theme changes
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                    if (this.state.config.theme === 'auto') {
                        if (e.matches) {
                            document.documentElement.classList.add('dark');
                        } else {
                            document.documentElement.classList.remove('dark');
                        }
                        this.updateThemeIcons();
                        this.updateChartsTheme();
                    }
                });
            }

            updateThemeIcons() {
                const sunIcon = document.getElementById('sun-icon');
                const moonIcon = document.getElementById('moon-icon');
                
                if (sunIcon && moonIcon) {
                    const isDark = document.documentElement.classList.contains('dark');
                    sunIcon.classList.toggle('hidden', !isDark);
                    moonIcon.classList.toggle('hidden', isDark);
                }
            }

            initializeDataStructures() {
                // Initialize data structure for ALL 24h periods and fronts
                this.timeSlots.forEach(slot => {
                    if (!this.state.data.periods[slot.period]) {
                        this.state.data.periods[slot.period] = {
                            fronts: {}
                        };
                    }
                    
                    this.state.fronts.forEach(front => {
                        if (!this.state.data.periods[slot.period].fronts[front]) {
                            this.state.data.periods[slot.period].fronts[front] = {
                                hour1: { density: 0, trips: 0, delivery: 0 },
                                hour2: { density: 0, trips: 0, delivery: 0 },
                                total: { density: 0, trips: 0, delivery: 0, efficiency: 0 }
                            };
                        }
                    });
                });
                
                console.log('📊 Estrutura de dados 24h inicializada para todas as frentes');
            }

            // Initialize front configurations with potential, goals, and TYPE
            initializeFrontConfigs() {
                this.state.fronts.forEach(front => {
                    if (!this.state.data.frontConfigs[front]) {
                        this.state.data.frontConfigs[front] = {
                            type: 'own', // Default to 'own' (própria)
                            dailyGoal: this.state.config.defaultFrontGoal,
                            defaultPotential: this.state.config.defaultPotentialPerHour,
                            hourlyPotential: {},
                            notes: ''
                        };
                        
                        // Initialize hourly potential for all 24 hours
                        this.hours24.forEach(hour => {
                            this.state.data.frontConfigs[front].hourlyPotential[hour] = this.state.config.defaultPotentialPerHour;
                        });
                    } else {
                        // Ensure type field exists for existing configs
                        if (!this.state.data.frontConfigs[front].type) {
                            this.state.data.frontConfigs[front].type = 'own';
                        }
                    }
                });
                
                this.updateGlobalGoals();
                console.log('⚙️ Configurações de frentes inicializadas com tipos');
            }

            updateGlobalGoals() {
                // Calculate total daily goal from all fronts
                let totalGoal = 0;
                this.state.fronts.forEach(front => {
                    const config = this.state.data.frontConfigs[front];
                    if (config && config.dailyGoal) {
                        totalGoal += parseFloat(config.dailyGoal) || 0;
                    }
                });
                this.state.data.dailyGoals.delivery = totalGoal;
                
                console.log(`📊 Meta global atualizada: ${totalGoal}t`);
            }

            // Utility function to determine if front is own or third party
            isFrontOwn(front) {
                const config = this.state.data.frontConfigs[front];
                return config?.type === 'own';
            }

            // Get fronts separated by type
            getFrontsByType() {
                const own = [];
                const third = [];
                
                this.state.fronts.forEach(front => {
                    if (this.isFrontOwn(front)) {
                        own.push(front);
                    } else {
                        third.push(front);
                    }
                });
                
                return { own, third };
            }

            // Calculate data separated by front type
            calculateSeparatedData() {
                const { own, third } = this.getFrontsByType();
                const result = {
                    own: { delivered: 0, missing: 0, potential: 0, trips: 0, efficiency: 0 },
                    third: { delivered: 0, missing: 0, potential: 0, trips: 0, efficiency: 0 },
                    total: { delivered: 0, missing: 0, potential: 0, trips: 0, efficiency: 0 }
                };

                // Calculate for own fronts
                own.forEach(front => {
                    const frontData = this.calculateFrontTotals(front);
                    result.own.delivered += frontData.delivered;
                    result.own.potential += frontData.potential;
                    result.own.trips += frontData.trips;
                });
                result.own.missing = Math.max(0, result.own.potential - result.own.delivered);
                result.own.efficiency = result.own.potential > 0 ? (result.own.delivered / result.own.potential) * 100 : 0;

                // Calculate for third party fronts
                third.forEach(front => {
                    const frontData = this.calculateFrontTotals(front);
                    result.third.delivered += frontData.delivered;
                    result.third.potential += frontData.potential;
                    result.third.trips += frontData.trips;
                });
                result.third.missing = Math.max(0, result.third.potential - result.third.delivered);
                result.third.efficiency = result.third.potential > 0 ? (result.third.delivered / result.third.potential) * 100 : 0;

                // Calculate totals
                result.total.delivered = result.own.delivered + result.third.delivered;
                result.total.missing = result.own.missing + result.third.missing;
                result.total.potential = result.own.potential + result.third.potential;
                result.total.trips = result.own.trips + result.third.trips;
                result.total.efficiency = result.total.potential > 0 ? (result.total.delivered / result.total.potential) * 100 : 0;

                return result;
            }

            calculateFrontTotals(front) {
                let delivered = 0;
                let potential = 0;
                let trips = 0;

                this.timeSlots.forEach(slot => {
                    const frontData = this.state.data.periods[slot.period].fronts[front];
                    if (frontData) {
                        delivered += frontData.total.delivery;
                        trips += frontData.total.trips;
                        
                        // Only add potential if there's actual data
                        if (frontData.total.trips > 0) {
                            const frontConfig = this.state.data.frontConfigs[front];
                            if (frontConfig?.hourlyPotential) {
                                slot.hours.forEach(hour => {
                                    potential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                                });
                            }
                        }
                    }
                });

                return { delivered, potential, trips, missing: Math.max(0, potential - delivered) };
            }

            // Data Management
            loadData() {
                try {
                    // Always load general configuration first (fronts list and configurations)
                    const generalData = localStorage.getItem('ggomes-log-data-v83-config');
                    if (generalData) {
                        const data = JSON.parse(generalData);
                        
                        if (data.fronts && Array.isArray(data.fronts)) {
                            this.state.fronts = data.fronts;
                        }
                        
                        if (data.data?.frontConfigs) {
                            this.state.data.frontConfigs = data.data.frontConfigs;
                        }
                        
                        if (data.data?.dailyGoals) {
                            this.state.data.dailyGoals = data.data.dailyGoals;
                        }

                        if (data.config) {
                            this.state.config = { ...this.state.config, ...data.config };
                        }

                        // Load reports history
                        if (data.reports) {
                            this.state.reports = { ...this.state.reports, ...data.reports };
                        }
                        
                        console.log('✅ Configurações gerais carregadas com tipos de frente');
                    }
                    
                    // Load data specific to the current date
                    this.loadDateSpecificData();
                    
                } catch (error) {
                    console.error('❌ Erro ao carregar dados:', error);
                    this.showToast('Erro ao carregar dados salvos. Usando configurações padrão.', 'warning');
                }
            }

            // Load data specific to a date
            loadDateSpecificData() {
                try {
                    const dateKey = `ggomes-log-data-v83-${this.state.currentDate}`;
                    const dateData = localStorage.getItem(dateKey);
                    
                    // Initialize empty periods structure first
                    this.state.data.periods = {};
                    this.timeSlots.forEach(slot => {
                        this.state.data.periods[slot.period] = { fronts: {} };
                        this.state.fronts.forEach(front => {
                            this.state.data.periods[slot.period].fronts[front] = {
                                hour1: { density: 0, trips: 0, delivery: 0 },
                                hour2: { density: 0, trips: 0, delivery: 0 },
                                total: { density: 0, trips: 0, delivery: 0, efficiency: 0 }
                            };
                        });
                    });
                    
                    if (dateData) {
                        const data = JSON.parse(dateData);
                        
                        if (data.data?.periods) {
                            // Merge saved data with initialized structure
                            Object.keys(data.data.periods).forEach(periodKey => {
                                if (this.state.data.periods[periodKey]) {
                                    Object.keys(data.data.periods[periodKey].fronts).forEach(front => {
                                        if (this.state.data.periods[periodKey].fronts[front]) {
                                            this.state.data.periods[periodKey].fronts[front] = {
                                                ...this.state.data.periods[periodKey].fronts[front],
                                                ...data.data.periods[periodKey].fronts[front]
                                            };
                                        }
                                    });
                                }
                            });
                        }
                        
                        if (data.activePeriod) {
                            this.state.activePeriod = data.activePeriod;
                        }
                        
                        console.log('✅ Dados específicos carregados para data:', this.state.currentDate);
                    } else {
                        // Reset active period to first one for new dates
                        this.state.activePeriod = this.timeSlots[0].period;
                        console.log('📅 Nova data inicializada:', this.state.currentDate);
                    }
                    
                    // Ensure front configs exist
                    this.initializeFrontConfigs();
                    
                } catch (error) {
                    console.error('❌ Erro ao carregar dados da data:', error);
                    this.initializeDataStructures();
                }
            }

            // Save data with proper date and configuration management
            saveData() {
                try {
                    // Always update global goals before saving
                    this.updateGlobalGoals();
                    
                    // Save general configuration (fronts, configurations, global settings, reports)
                    const configData = {
                        version: this.version,
                        timestamp: new Date().toISOString(),
                        fronts: this.state.fronts,
                        data: {
                            frontConfigs: this.state.data.frontConfigs,
                            dailyGoals: this.state.data.dailyGoals
                        },
                        config: this.state.config,
                        reports: this.state.reports
                    };
                    localStorage.setItem('ggomes-log-data-v83-config', JSON.stringify(configData));
                    
                    // Save date-specific data (periods and active period)
                    const dateData = {
                        version: this.version,
                        timestamp: new Date().toISOString(),
                        currentDate: this.state.currentDate,
                        activePeriod: this.state.activePeriod,
                        data: {
                            periods: this.state.data.periods
                        }
                    };
                    const dateKey = `ggomes-log-data-v83-${this.state.currentDate}`;
                    localStorage.setItem(dateKey, JSON.stringify(dateData));
                    
                    this.state.ui.unsavedChanges = false;
                    
                    console.log('💾 Dados salvos para data:', this.state.currentDate);
                    this.showToast(`💾 Dados salvos para ${this.formatDate(this.state.currentDate)}`, 'success');
                    
                    // Update auto-save indicator
                    const indicator = document.getElementById('auto-save-indicator');
                    if (indicator) {
                        indicator.className = 'status-indicator status-success';
                        setTimeout(() => {
                            indicator.className = 'status-indicator status-info';
                        }, 2000);
                    }
                } catch (error) {
                    console.error('❌ Erro ao salvar:', error);
                    this.showToast('Erro ao salvar dados', 'error');
                }
            }

            // Dynamic Color Generator
            generateDynamicColors(count) {
                const baseColors = [
                    '#10B981', // Green
                    '#5D5CDE', // Primary Purple
                    '#F59E0B', // Orange
                    '#EF4444', // Red
                    '#3B82F6', // Blue
                    '#8B5CF6', // Violet
                    '#F97316', // Orange-Red
                    '#06B6D4', // Cyan
                    '#84CC16', // Lime
                    '#EC4899', // Pink
                    '#6366F1', // Indigo
                    '#14B8A6', // Teal
                    '#F472B6', // Pink-400
                    '#A855F7', // Purple-500
                    '#22C55E', // Green-500
                    '#EAB308', // Yellow-500
                    '#DC2626', // Red-600
                    '#2563EB', // Blue-600
                ];

                // If we need more colors than base colors, generate additional ones
                if (count <= baseColors.length) {
                    return baseColors.slice(0, count);
                }

                const colors = [...baseColors];
                const hueStep = 360 / count;
                
                // Generate additional colors using HSL
                for (let i = baseColors.length; i < count; i++) {
                    const hue = (i * hueStep) % 360;
                    const saturation = 70 + (i % 3) * 10; // Vary saturation
                    const lightness = 50 + (i % 2) * 10; // Vary lightness
                    colors.push(`hsl(${hue}, ${saturation}%, ${lightness}%)`);
                }

                return colors;
            }

            setupEventListeners() {
                if (this.eventListenersAdded) {
                    console.log('⚠️ Event listeners já foram adicionados');
                    return;
                }

                try {
                    // Core Navigation
                    this.addEventListenerSafe('sidebar-toggle', 'click', () => this.toggleSidebar());
                    this.addEventListenerSafe('sidebar-overlay', 'click', () => this.toggleSidebar(false));
                    
                    // Header Actions
                    this.addEventListenerSafe('theme-toggle', 'click', () => this.toggleTheme());
                    this.addEventListenerSafe('save-data', 'click', () => this.saveData());
                    this.addEventListenerSafe('search-trigger', 'click', () => this.showSearch());
                    this.addEventListenerSafe('close-search', 'click', () => this.hideSearch());
                    this.addEventListenerSafe('search-backdrop', 'click', () => this.hideSearch());
                    this.addEventListenerSafe('floating-action', 'click', () => this.showQuickActions());
                    this.addEventListenerSafe('notifications-trigger', 'click', () => this.showNotifications());

                    // Date Navigation
                    this.addEventListenerSafe('prev-date', 'click', () => this.navigateDate(-1));
                    this.addEventListenerSafe('next-date', 'click', () => this.navigateDate(1));
                    this.addEventListenerSafe('date-picker', 'click', () => this.showDatePicker());

                    // Dashboard Actions
                    this.addEventListenerSafe('refresh-dashboard', 'click', () => this.refreshDashboard());
                    this.addEventListenerSafe('export-dashboard', 'click', () => this.exportDashboard());
                    this.addEventListenerSafe('table-export', 'click', () => this.exportTable());

                    // Enhanced Entrega por Hora Actions
                    this.addEventListenerSafe('manage-fronts', 'click', () => this.showManageFrontsModal());
                    this.addEventListenerSafe('close-fronts-modal', 'click', () => this.hideManageFrontsModal());
                    this.addEventListenerSafe('fronts-modal-backdrop', 'click', () => this.hideManageFrontsModal());
                    this.addEventListenerSafe('add-front-btn', 'click', () => this.addFront());
                    this.addEventListenerSafe('clear-period', 'click', () => this.clearCurrentPeriod());
                    this.addEventListenerSafe('export-period', 'click', () => this.exportCurrentPeriod());

                    // NEW: Enhanced input mode actions
                    this.addEventListenerSafe('copy-previous-period', 'click', () => this.copyPreviousPeriod());
                    this.addEventListenerSafe('bulk-input-mode', 'click', () => this.switchInputMode('bulk'));
                    this.addEventListenerSafe('validate-all-inputs', 'click', () => this.validateAllInputs());
                    this.addEventListenerSafe('clear-period-inputs', 'click', () => this.clearPeriodInputs());
                    this.addEventListenerSafe('apply-bulk-hour1', 'click', () => this.applyBulkInput('hour1'));
                    this.addEventListenerSafe('apply-bulk-hour2', 'click', () => this.applyBulkInput('hour2'));
                    this.addEventListenerSafe('period-navigation-help', 'click', () => this.showPeriodHelp());

                    // Front Configuration Actions
                    this.addEventListenerSafe('add-new-front-config', 'click', () => this.showNewFrontConfigModal());
                    this.addEventListenerSafe('import-config', 'click', () => this.importConfiguration());
                    this.addEventListenerSafe('export-config', 'click', () => this.exportConfiguration());

                    // Front Configuration Modal
                    this.addEventListenerSafe('close-config-modal', 'click', () => this.hideFrontConfigModal());
                    this.addEventListenerSafe('config-modal-backdrop', 'click', () => this.hideFrontConfigModal());
                    this.addEventListenerSafe('cancel-config', 'click', () => this.hideFrontConfigModal());
                    this.addEventListenerSafe('save-config', 'click', () => this.saveFrontConfiguration());
                    this.addEventListenerSafe('copy-default-potential', 'click', () => this.copyDefaultPotential());

                    // Reports Event Listeners
                    this.addEventListenerSafe('generate-all-reports', 'click', () => this.generateAllReports());
                    this.addEventListenerSafe('schedule-reports', 'click', () => this.scheduleReports());
                    this.addEventListenerSafe('export-reports-config', 'click', () => this.exportReportsConfig());
                    this.addEventListenerSafe('clear-reports-history', 'click', () => this.clearReportsHistory());

                    // Search
                    this.addEventListenerSafe('search-input', 'input', (e) => this.handleSearch(e));
                    this.addEventListenerSafe('table-search', 'input', (e) => this.handleTableSearch(e));

                    // New front input
                    this.addEventListenerSafe('new-front-input', 'keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.addFront();
                        }
                    });

                    // Navigation Links
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const page = link.dataset.page;
                            if (page) {
                                this.showPage(page);
                                if (window.innerWidth < 1024) {
                                    this.toggleSidebar(false);
                                }
                            }
                        });
                    });

                    // Setup Chart Controls
                    this.setupChartControls();
                    this.setupIndividualAnalysisControls();

                    // NEW: Enhanced Input Mode Controls
                    this.setupInputModeControls();

                    // Report Generation Buttons
                    document.querySelectorAll('.generate-report-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const reportType = btn.dataset.type;
                            this.generateReport(reportType);
                        });
                    });

                    // Global Events - OPTIMIZED for inputs
                    document.addEventListener('keydown', (e) => this.handleKeyboardShortcuts(e));
                    
                    // IMPORTANT: Use delegation for data inputs to avoid multiple listeners
                    document.addEventListener('input', (e) => {
                        if (e.target.classList.contains('data-input')) {
                            this.handleInputChangeWithDebounce(e);
                        }
                    });
                    
                    window.addEventListener('resize', () => this.handleResize());
                    
                    // Mark as added
                    this.eventListenersAdded = true;
                    console.log('🎯 Event listeners configurados com interface aprimorada');

                } catch (error) {
                    console.error('❌ Erro ao configurar event listeners:', error);
                    this.showToast('Erro ao configurar eventos do sistema', 'error');
                }
            }

            addEventListenerSafe(id, event, handler) {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener(event, handler);
                    return true;
                } else {
                    console.warn(`⚠️ Element '${id}' not found for event '${event}'`);
                    return false;
                }
            }

            setupChartControls() {
                // Chart period buttons
                document.querySelectorAll('.chart-period-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        this.switchChartPeriod(btn.dataset.period);
                    });
                });
            }

            // Setup individual analysis controls
            setupIndividualAnalysisControls() {
                // Front filter for individual chart
                const frontFilter = document.getElementById('front-filter');
                if (frontFilter) {
                    frontFilter.addEventListener('change', (e) => {
                        this.filterIndividualChart(e.target.value);
                    });
                }

                // Timeline front filter
                const timelineFilter = document.getElementById('timeline-front-filter');
                if (timelineFilter) {
                    timelineFilter.addEventListener('change', (e) => {
                        this.filterTimelineChart(e.target.value);
                    });
                }

                // Sort buttons for performance cards
                document.querySelectorAll('.sort-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.sort-btn').forEach(b => {
                            b.classList.remove('active');
                            b.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-600', 'dark:text-gray-300');
                            b.classList.remove('bg-primary', 'text-white');
                        });
                        
                        btn.classList.add('active');
                        btn.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-600', 'dark:text-gray-300');
                        btn.classList.add('bg-primary', 'text-white');
                        
                        this.generateIndividualPerformanceCards();
                    });
                });
            }

            // NEW: Setup enhanced input mode controls
            setupInputModeControls() {
                // Input mode buttons
                document.querySelectorAll('.input-mode-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const mode = btn.dataset.mode;
                        if (mode) {
                            this.switchInputMode(mode);
                        }
                    });
                });

                // Tab buttons for configuration modal
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tab = btn.dataset.tab;
                        if (tab) {
                            this.switchConfigTab(tab);
                        }
                    });
                });
            }

            initializeUI() {
                // Setup initial UI state
                this.updateFrontsList();
                this.generateTimePeriodButtons();
                this.updatePeriodContent();
                this.generateDashboardTable();
                this.generateFrontConfigCards();
                this.updateAllRealData();
                this.updateQuickStats();
                this.updateActiveEntriesCount();
                this.updateReportsLastGenerated();
                this.updatePeriodProgress();
                
                console.log('🎨 Interface inicializada com recursos aprimorados');
            }

            generateTimePeriodButtons() {
                const container = document.getElementById('time-periods-container');
                if (!container) return;

                container.innerHTML = this.timeSlots.map((slot, index) => {
                    const hasData = this.periodHasData(slot.period);
                    const isActive = slot.period === this.state.activePeriod;
                    
                    return `
                        <div class="time-period-card ${isActive ? 'active' : ''} ${hasData ? 'has-data' : ''}" data-period="${slot.period}">
                            <div class="text-sm font-bold">${slot.start}-${slot.end}</div>
                            <div class="text-xs opacity-70 mt-1">${slot.label}</div>
                            <div class="text-xs mt-2">
                                <span class="font-medium" id="period-summary-${slot.period}">0t</span>
                            </div>
                            ${hasData ? '<div class="absolute top-2 right-2 w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>' : ''}
                        </div>
                    `;
                }).join('');

                // Add click events
                container.querySelectorAll('.time-period-card').forEach(card => {
                    card.addEventListener('click', () => {
                        const period = card.dataset.period;
                        if (period) {
                            this.switchTimePeriod(period);
                        }
                    });
                });

                // Update period summaries
                this.updatePeriodSummaries();
            }

            // Check if period has data
            periodHasData(period) {
                const periodData = this.state.data.periods[period];
                if (!periodData) return false;
                
                return this.state.fronts.some(front => {
                    const frontData = periodData.fronts[front];
                    return frontData && frontData.total.trips > 0;
                });
            }

            updatePeriodSummaries() {
                this.timeSlots.forEach(slot => {
                    const element = document.getElementById(`period-summary-${slot.period}`);
                    if (element) {
                        const periodData = this.state.data.periods[slot.period];
                        let totalDelivery = 0;
                        
                        this.state.fronts.forEach(front => {
                            if (periodData.fronts[front]) {
                                totalDelivery += periodData.fronts[front].total.delivery;
                            }
                        });
                        
                        element.textContent = `${totalDelivery.toFixed(1)}t`;
                    }
                });
            }

            // NEW: Update period progress bar
            updatePeriodProgress() {
                const periodsWithData = this.timeSlots.filter(slot => this.periodHasData(slot.period)).length;
                const totalPeriods = this.timeSlots.length;
                const progressPercentage = (periodsWithData / totalPeriods) * 100;

                const progressBar = document.getElementById('period-progress-bar');
                const progressText = document.getElementById('period-progress-text');

                if (progressBar) {
                    progressBar.style.width = `${progressPercentage}%`;
                }

                if (progressText) {
                    progressText.textContent = `${periodsWithData} de ${totalPeriods} períodos com dados`;
                }
            }

            generateFrontConfigCards() {
                const container = document.getElementById('fronts-config-grid');
                if (!container) return;

                container.innerHTML = this.state.fronts.map(front => {
                    const config = this.state.data.frontConfigs[front] || {};
                    const dailyGoal = parseFloat(config.dailyGoal) || 0;
                    const defaultPotential = parseFloat(config.defaultPotential) || 0;
                    const frontType = config.type || 'own';
                    
                    // Calculate total potential for this front (sum of hours with data only)
                    let totalUsedPotential = 0;
                    let totalConfiguredPotential = 0;
                    if (config.hourlyPotential) {
                        this.hours24.forEach(hour => {
                            totalConfiguredPotential += parseFloat(config.hourlyPotential[hour]) || 0;
                        });
                        
                        // Calculate only potential for hours with actual data
                        this.timeSlots.forEach(slot => {
                            const frontData = this.state.data.periods[slot.period].fronts[front];
                            if (frontData && frontData.total.trips > 0) {
                                slot.hours.forEach(hour => {
                                    totalUsedPotential += parseFloat(config.hourlyPotential[hour]) || 0;
                                });
                            }
                        });
                    }
                    
                    // Calculate current delivery for this front
                    let currentDelivery = 0;
                    this.timeSlots.forEach(slot => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData) {
                            currentDelivery += frontData.total.delivery;
                        }
                    });
                    
                    // Calculate missing delivery (saldo devedor) based on potential vs delivered
                    const missingDelivery = Math.max(0, totalUsedPotential - currentDelivery);
                    
                    const goalProgress = dailyGoal > 0 ? (currentDelivery / dailyGoal) * 100 : 0;
                    const potentialProgress = totalUsedPotential > 0 ? (currentDelivery / totalUsedPotential) * 100 : 0;

                    const typeColor = frontType === 'own' ? 'from-green-500 to-green-600' : 'from-orange-500 to-orange-600';
                    const typeBadge = frontType === 'own' ? 'P' : 'T';
                    const typeLabel = frontType === 'own' ? 'Própria' : 'Terceira';

                    return `
                        <div class="config-card rounded-2xl p-6 shadow-xl interactive">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="relative w-12 h-12 bg-gradient-to-br ${typeColor} rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg">
                                        F
                                        <div class="front-type-badge ${frontType === 'own' ? 'front-type-own' : 'front-type-third'}">${typeBadge}</div>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-900 dark:text-white">Frente ${front}</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">${typeLabel} - Meta: ${dailyGoal.toFixed(0)}t - Usado: ${totalUsedPotential.toFixed(0)}t</p>
                                    </div>
                                </div>
                                <button class="config-front-btn p-2 text-gray-400 hover:text-primary transition-colors" data-front="${front}">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                </button>
                            </div>

                            <div class="space-y-4">
                                <div class="grid grid-cols-3 gap-4">
                                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3">
                                        <div class="text-sm text-blue-600 dark:text-blue-400 font-medium">Meta</div>
                                        <div class="text-lg font-bold text-blue-700 dark:text-blue-300">${dailyGoal.toFixed(0)}t</div>
                                    </div>
                                    <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-3">
                                        <div class="text-sm text-green-600 dark:text-green-400 font-medium">Atual</div>
                                        <div class="text-lg font-bold text-green-700 dark:text-green-300">${currentDelivery.toFixed(1)}t</div>
                                    </div>
                                    <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-3">
                                        <div class="text-sm text-red-600 dark:text-red-400 font-medium">Devedor</div>
                                        <div class="text-lg font-bold text-red-700 dark:text-red-300">${missingDelivery.toFixed(1)}t</div>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-gray-600 dark:text-gray-400">Progresso vs Meta</span>
                                        <span class="font-medium text-gray-900 dark:text-white">${goalProgress.toFixed(1)}%</span>
                                    </div>
                                    <div class="efficiency-bar h-2">
                                        <div class="efficiency-fill bg-gradient-to-r from-blue-500 to-blue-600" style="width: ${Math.min(goalProgress, 100)}%"></div>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex justify-between text-sm mb-2">
                                        <span class="text-gray-600 dark:text-gray-400">Eficiência (fórmula corrigida)</span>
                                        <span class="font-medium text-gray-900 dark:text-white">${potentialProgress.toFixed(1)}%</span>
                                    </div>
                                    <div class="efficiency-bar h-2">
                                        <div class="efficiency-fill bg-gradient-to-r from-purple-500 to-purple-600" style="width: ${Math.min(potentialProgress, 100)}%"></div>
                                    </div>
                                </div>

                                <div class="pt-2 border-t border-gray-200/50 dark:border-gray-700/50">
                                    <div class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
                                        <div>Tipo: ${typeLabel} | Padrão/hora: ${defaultPotential}t</div>
                                        <div>Pot. total: ${totalConfiguredPotential.toFixed(0)}t | Usado: ${totalUsedPotential.toFixed(0)}t</div>
                                        ${config.notes ? `<div>Obs: ${config.notes}</div>` : ''}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                // Add click listeners for configuration buttons
                container.querySelectorAll('.config-front-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const front = btn.dataset.front;
                        this.showFrontConfigModal(front);
                    });
                });
            }

            async initializeCharts() {
                if (!this.isChartsLibraryLoaded) {
                    console.warn('⚠️ Chart.js não disponível - pulando criação de gráficos');
                    return;
                }

                try {
                    await this.createPerformanceChart();
                    await this.createEfficiencyChart();
                    await this.createIndividualPerformanceChart();
                    await this.createTimelinePerformanceChart();
                    this.generateIndividualPerformanceCards();
                    console.log('📈 Gráficos criados com sucesso - com análise individual por frente');
                } catch (error) {
                    console.error('❌ Erro ao criar gráficos:', error);
                    this.showToast('Erro ao carregar gráficos', 'error');
                }
            }

            async createPerformanceChart() {
                const ctx = document.getElementById('performance-chart');
                if (!ctx) return;

                const isDark = document.documentElement.classList.contains('dark');
                
                // Get REAL data for chart using CORRECTED formula
                const realData = this.getRealPerformanceData();
                
                this.charts.performance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: this.timeSlots.map(slot => slot.start),
                        datasets: [{
                            label: 'Entregue (t)',
                            data: realData.delivered,
                            borderColor: '#5D5CDE',
                            backgroundColor: 'rgba(93, 92, 222, 0.1)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 3,
                            pointBackgroundColor: '#5D5CDE',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }, {
                            label: 'Potencial (só horas c/ dados)',
                            data: realData.potential,
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: false,
                            borderDash: [8, 5],
                            borderWidth: 3,
                            pointBackgroundColor: '#10B981',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    usePointStyle: true,
                                    font: { family: 'Inter', weight: '500' },
                                    color: isDark ? '#E5E7EB' : '#374151'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderWidth: 0,
                                cornerRadius: 12,
                                padding: 16,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}t`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { 
                                    color: isDark ? 'rgba(75, 85, 99, 0.3)' : 'rgba(0, 0, 0, 0.08)',
                                    drawBorder: false
                                },
                                ticks: { 
                                    font: { family: 'Inter' },
                                    color: isDark ? '#D1D5DB' : '#6B7280'
                                }
                            },
                            y: {
                                grid: { 
                                    color: isDark ? 'rgba(75, 85, 99, 0.3)' : 'rgba(0, 0, 0, 0.08)',
                                    drawBorder: false
                                },
                                ticks: { 
                                    font: { family: 'Inter' },
                                    color: isDark ? '#D1D5DB' : '#6B7280',
                                    callback: function(value) {
                                        return value.toFixed(0) + 't';
                                    }
                                },
                                beginAtZero: true
                            }
                        },
                        animation: {
                            duration: 750,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
            }

            // Get real performance data using corrected formula
            getRealPerformanceData() {
                const delivered = [];
                const potential = [];
                
                this.timeSlots.forEach(slot => {
                    let periodDelivered = 0;
                    let periodPotential = 0;
                    
                    this.state.fronts.forEach(front => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData) {
                            periodDelivered += frontData.total.delivery;
                            
                            // Only add potential if there's actual data (trips > 0)
                            if (frontData.total.trips > 0) {
                                const frontConfig = this.state.data.frontConfigs[front];
                                if (frontConfig?.hourlyPotential) {
                                    slot.hours.forEach(hour => {
                                        periodPotential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                                    });
                                } else {
                                    // Fallback to default
                                    periodPotential += this.state.config.defaultPotentialPerHour * 2;
                                }
                            }
                        }
                    });
                    
                    delivered.push(periodDelivered);
                    potential.push(periodPotential);
                });
                
                return { delivered, potential };
            }

            // Efficiency chart with dynamic colors and type separation
            async createEfficiencyChart() {
                const ctx = document.getElementById('front-efficiency-chart');
                if (!ctx) return;

                // Get REAL efficiency data using CORRECTED formula
                const realEfficiencyData = this.getRealEfficiencyData();

                // Generate dynamic colors based on current number of fronts
                const dynamicColors = this.generateDynamicColors(this.state.fronts.length);

                const isDark = document.documentElement.classList.contains('dark');

                this.charts.efficiency = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: this.state.fronts.map(front => {
                            const config = this.state.data.frontConfigs[front] || {};
                            const typeLabel = config.type === 'own' ? 'P' : 'T';
                            return `F${front} (${typeLabel})`;
                        }),
                        datasets: [{
                            data: realEfficiencyData.efficiencies,
                            backgroundColor: dynamicColors,
                            borderWidth: 4,
                            borderColor: isDark ? '#1F2937' : '#fff',
                            hoverBorderWidth: 6,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '65%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 24,
                                    usePointStyle: true,
                                    font: { family: 'Inter', size: 13, weight: '500' },
                                    color: isDark ? '#E5E7EB' : '#374151',
                                    generateLabels: (chart) => {
                                        const data = chart.data;
                                        return data.labels.map((label, i) => ({
                                            text: `${label}: ${data.datasets[0].data[i].toFixed(1)}%`,
                                            fillStyle: data.datasets[0].backgroundColor[i],
                                            strokeStyle: data.datasets[0].borderColor,
                                            lineWidth: data.datasets[0].borderWidth,
                                            pointStyle: 'circle',
                                            hidden: false,
                                            index: i
                                        }));
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderWidth: 0,
                                cornerRadius: 12,
                                padding: 16,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.label}: ${context.parsed.toFixed(1)}%`;
                                    }
                                }
                            }
                        },
                        animation: {
                            duration: 750,
                            easing: 'easeInOutQuart'
                        }
                    }
                });

                console.log('🎨 Gráfico de eficiência criado com cores dinâmicas para', this.state.fronts.length, 'frentes');
            }

            // Get real efficiency data using corrected formula
            getRealEfficiencyData() {
                const efficiencies = [];
                
                this.state.fronts.forEach(front => {
                    let totalDelivery = 0;
                    let totalUsedPotential = 0;
                    
                    this.timeSlots.forEach(slot => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData) {
                            totalDelivery += frontData.total.delivery;
                            
                            // Only add potential if there's actual data (trips > 0)
                            if (frontData.total.trips > 0) {
                                const frontConfig = this.state.data.frontConfigs[front];
                                if (frontConfig?.hourlyPotential) {
                                    slot.hours.forEach(hour => {
                                        totalUsedPotential += parseFloat(frontConfig.hourlyPotential[hour]) || 0;
                                    });
                                } else {
                                    // Fallback
                                    totalUsedPotential += this.state.config.defaultPotentialPerHour * 2;
                                }
                            }
                        }
                    });
                    
                    const efficiency = totalUsedPotential > 0 ? (totalDelivery / totalUsedPotential) * 100 : 0;
                    efficiencies.push(Math.min(efficiency, 100));
                });
                
                return { efficiencies };
            }

            // Create Individual Performance Chart (Bar Chart comparing Delivered vs Potential vs Goal)
            async createIndividualPerformanceChart() {
                const ctx = document.getElementById('individual-performance-chart');
                if (!ctx) return;

                const isDark = document.documentElement.classList.contains('dark');
                const individualData = this.getIndividualPerformanceData();

                this.charts.individualPerformance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: individualData.labels,
                        datasets: [
                            {
                                label: 'Entregue (t)',
                                data: individualData.delivered,
                                backgroundColor: 'rgba(16, 185, 129, 0.8)',
                                borderColor: '#10B981',
                                borderWidth: 2,
                                borderRadius: 4,
                                borderSkipped: false,
                            },
                            {
                                label: 'Potencial Usado (t)',
                                data: individualData.potential,
                                backgroundColor: 'rgba(93, 92, 222, 0.8)',
                                borderColor: '#5D5CDE',
                                borderWidth: 2,
                                borderRadius: 4,
                                borderSkipped: false,
                            },
                            {
                                label: 'Meta Diária (t)',
                                data: individualData.goals,
                                backgroundColor: 'rgba(245, 158, 11, 0.8)',
                                borderColor: '#F59E0B',
                                borderWidth: 2,
                                borderRadius: 4,
                                borderSkipped: false,
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    font: { family: 'Inter', weight: '500' },
                                    color: isDark ? '#E5E7EB' : '#374151',
                                    padding: 20
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderWidth: 0,
                                cornerRadius: 12,
                                padding: 16,
                                callbacks: {
                                    label: function(context) {
                                        const frontData = individualData.fronts[context.dataIndex];
                                        const efficiency = frontData.potential > 0 ? (frontData.delivered / frontData.potential * 100).toFixed(1) : '0';
                                        return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}t (Eficiência: ${efficiency}%)`;
                                    },
                                    afterLabel: function(context) {
                                        const frontData = individualData.fronts[context.dataIndex];
                                        return `Tipo: ${frontData.type} | Viagens: ${frontData.trips}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { 
                                    color: isDark ? 'rgba(75, 85, 99, 0.3)' : 'rgba(0, 0, 0, 0.08)',
                                    drawBorder: false
                                },
                                ticks: { 
                                    font: { family: 'Inter' },
                                    color: isDark ? '#D1D5DB' : '#6B7280'
                                }
                            },
                            y: {
                                grid: { 
                                    color: isDark ? 'rgba(75, 85, 99, 0.3)' : 'rgba(0, 0, 0, 0.08)',
                                    drawBorder: false
                                },
                                ticks: { 
                                    font: { family: 'Inter' },
                                    color: isDark ? '#D1D5DB' : '#6B7280',
                                    callback: function(value) {
                                        return value.toFixed(0) + 't';
                                    }
                                },
                                beginAtZero: true
                            }
                        },
                        animation: {
                            duration: 750,
                            easing: 'easeInOutQuart'
                        }
                    }
                });

                console.log('📊 Gráfico de análise individual criado');
            }

            // Create Timeline Performance Chart (Line Chart showing delivery over time periods)
            async createTimelinePerformanceChart() {
                const ctx = document.getElementById('timeline-performance-chart');
                if (!ctx) return;

                const isDark = document.documentElement.classList.contains('dark');
                const timelineData = this.getTimelinePerformanceData();

                this.charts.timelinePerformance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: this.timeSlots.map(slot => slot.start),
                        datasets: timelineData.datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    font: { family: 'Inter', weight: '500', size: 11 },
                                    color: isDark ? '#E5E7EB' : '#374151',
                                    padding: 15,
                                    generateLabels: function(chart) {
                                        const original = Chart.defaults.plugins.legend.labels.generateLabels;
                                        const labels = original.call(this, chart);
                                        
                                        // Limit to first 6 fronts to avoid overcrowding
                                        return labels.slice(0, 6);
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.9)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderWidth: 0,
                                cornerRadius: 12,
                                padding: 16,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}t`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { 
                                    color: isDark ? 'rgba(75, 85, 99, 0.3)' : 'rgba(0, 0, 0, 0.08)',
                                    drawBorder: false
                                },
                                ticks: { 
                                    font: { family: 'Inter' },
                                    color: isDark ? '#D1D5DB' : '#6B7280'
                                }
                            },
                            y: {
                                grid: { 
                                    color: isDark ? 'rgba(75, 85, 99, 0.3)' : 'rgba(0, 0, 0, 0.08)',
                                    drawBorder: false
                                },
                                ticks: { 
                                    font: { family: 'Inter' },
                                    color: isDark ? '#D1D5DB' : '#6B7280',
                                    callback: function(value) {
                                        return value.toFixed(0) + 't';
                                    }
                                },
                                beginAtZero: true
                            }
                        },
                        animation: {
                            duration: 750,
                            easing: 'easeInOutQuart'
                        }
                    }
                });

                // Setup timeline front filter
                this.updateTimelineFrontFilter();
                console.log('📈 Gráfico de timeline por frente criado');
            }

            // Get data for individual performance chart
            getIndividualPerformanceData() {
                const labels = [];
                const delivered = [];
                const potential = [];
                const goals = [];
                const fronts = [];

                this.state.fronts.forEach(front => {
                    const frontData = this.calculateFrontTotals(front);
                    const config = this.state.data.frontConfigs[front] || {};
                    const frontType = config.type === 'own' ? 'Própria' : 'Terceira';
                    
                    labels.push(`F${front}`);
                    delivered.push(frontData.delivered);
                    potential.push(frontData.potential);
                    goals.push(config.dailyGoal || 0);
                    
                    fronts.push({
                        front,
                        type: frontType,
                        delivered: frontData.delivered,
                        potential: frontData.potential,
                        goal: config.dailyGoal || 0,
                        trips: frontData.trips,
                        efficiency: frontData.potential > 0 ? (frontData.delivered / frontData.potential * 100) : 0
                    });
                });

                return { labels, delivered, potential, goals, fronts };
            }

            // Get data for timeline performance chart
            getTimelinePerformanceData() {
                const colors = this.generateDynamicColors(this.state.fronts.length);
                const datasets = [];

                this.state.fronts.forEach((front, index) => {
                    const data = [];
                    
                    this.timeSlots.forEach(slot => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        data.push(frontData ? frontData.total.delivery : 0);
                    });

                    const config = this.state.data.frontConfigs[front] || {};
                    const frontType = config.type === 'own' ? 'P' : 'T';

                    datasets.push({
                        label: `F${front} (${frontType})`,
                        data: data,
                        borderColor: colors[index],
                        backgroundColor: colors[index] + '20',
                        fill: false,
                        tension: 0.4,
                        borderWidth: 2,
                        pointBackgroundColor: colors[index],
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    });
                });

                return { datasets };
            }

            // Generate individual performance cards - CORRIGIDO para evitar sobreposição
            generateIndividualPerformanceCards() {
                const container = document.getElementById('individual-performance-cards');
                if (!container) return;

                const performanceData = this.state.fronts.map(front => {
                    const frontData = this.calculateFrontTotals(front);
                    const config = this.state.data.frontConfigs[front] || {};
                    const efficiency = frontData.potential > 0 ? (frontData.delivered / frontData.potential * 100) : 0;
                    const goalProgress = config.dailyGoal > 0 ? (frontData.delivered / config.dailyGoal * 100) : 0;
                    
                    return {
                        front,
                        type: config.type || 'own',
                        delivered: frontData.delivered,
                        potential: frontData.potential,
                        missing: frontData.missing,
                        goal: config.dailyGoal || 0,
                        trips: frontData.trips,
                        efficiency,
                        goalProgress
                    };
                });

                // Sort by current sort criteria
                const sortCriteria = document.querySelector('.sort-btn.active')?.id || 'sort-by-efficiency';
                this.sortPerformanceData(performanceData, sortCriteria);

                container.innerHTML = performanceData.map(data => {
                    const typeColor = data.type === 'own' ? 'from-green-500 to-green-600' : 'from-orange-500 to-orange-600';
                    const typeBadge = data.type === 'own' ? 'P' : 'T';
                    const typeLabel = data.type === 'own' ? 'Própria' : 'Terceira';
                    
                    const efficiencyColor = data.efficiency >= 90 ? 'text-green-600' : 
                                          data.efficiency >= 75 ? 'text-blue-600' : 
                                          data.efficiency >= 60 ? 'text-yellow-600' : 'text-red-600';

                    const efficiencyBg = data.efficiency >= 90 ? 'bg-green-100 dark:bg-green-900/20' : 
                                       data.efficiency >= 75 ? 'bg-blue-100 dark:bg-blue-900/20' : 
                                       data.efficiency >= 60 ? 'bg-yellow-100 dark:bg-yellow-900/20' : 'bg-red-100 dark:bg-red-900/20';

                    return `
                        <div class="individual-performance-card bg-white dark:bg-gray-800 rounded-xl p-4 shadow-lg border border-gray-200 dark:border-gray-700">
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center space-x-2">
                                    <div class="relative w-10 h-10 bg-gradient-to-br ${typeColor} rounded-lg flex items-center justify-center text-white font-bold shadow-md">
                                        F
                                        <div class="front-type-badge ${data.type === 'own' ? 'front-type-own' : 'front-type-third'}">${typeBadge}</div>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-gray-900 dark:text-white">Frente ${data.front}</h4>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">${typeLabel}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold ${efficiencyColor}">${data.efficiency.toFixed(1)}%</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">Eficiência</div>
                                </div>
                            </div>

                            <div class="space-y-3">
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-2">
                                        <div class="text-xs text-green-600 dark:text-green-400 font-medium">Entregue</div>
                                        <div class="text-sm font-bold text-green-700 dark:text-green-300">${data.delivered.toFixed(1)}t</div>
                                    </div>
                                    <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-2">
                                        <div class="text-xs text-blue-600 dark:text-blue-400 font-medium">Potencial</div>
                                        <div class="text-sm font-bold text-blue-700 dark:text-blue-300">${data.potential.toFixed(1)}t</div>
                                    </div>
                                    <div class="bg-orange-50 dark:bg-orange-900/20 rounded-lg p-2">
                                        <div class="text-xs text-orange-600 dark:text-orange-400 font-medium">Meta</div>
                                        <div class="text-sm font-bold text-orange-700 dark:text-orange-300">${data.goal.toFixed(0)}t</div>
                                    </div>
                                    <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-2">
                                        <div class="text-xs text-purple-600 dark:text-purple-400 font-medium">Viagens</div>
                                        <div class="text-sm font-bold text-purple-700 dark:text-purple-300">${data.trips}</div>
                                    </div>
                                </div>

                                <div class="space-y-2">
                                    <div>
                                        <div class="flex justify-between text-xs mb-1">
                                            <span class="text-gray-600 dark:text-gray-400">vs Potencial</span>
                                            <span class="font-medium ${efficiencyColor}">${data.efficiency.toFixed(1)}%</span>
                                        </div>
                                        <div class="efficiency-bar h-1.5">
                                            <div class="efficiency-fill bg-gradient-to-r from-green-500 to-green-600" style="width: ${Math.min(data.efficiency, 100)}%"></div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <div class="flex justify-between text-xs mb-1">
                                            <span class="text-gray-600 dark:text-gray-400">vs Meta</span>
                                            <span class="font-medium text-gray-900 dark:text-white">${data.goalProgress.toFixed(1)}%</span>
                                        </div>
                                        <div class="efficiency-bar h-1.5">
                                            <div class="efficiency-fill bg-gradient-to-r from-blue-500 to-blue-600" style="width: ${Math.min(data.goalProgress, 100)}%"></div>
                                        </div>
                                    </div>
                                </div>

                                ${data.missing > 0 ? `
                                    <div class="mt-2 p-2 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-700">
                                        <div class="flex items-center text-xs text-red-600 dark:text-red-400">
                                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                                            </svg>
                                            <span>Saldo devedor: ${data.missing.toFixed(1)}t</span>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('');

                console.log('🎯 Cards de performance individual gerados com layout corrigido');
            }

            // Sort performance data
            sortPerformanceData(data, criteria) {
                switch (criteria) {
                    case 'sort-by-efficiency':
                        data.sort((a, b) => b.efficiency - a.efficiency);
                        break;
                    case 'sort-by-delivery':
                        data.sort((a, b) => b.delivered - a.delivered);
                        break;
                    case 'sort-by-trips':
                        data.sort((a, b) => b.trips - a.trips);
                        break;
                    default:
                        data.sort((a, b) => b.efficiency - a.efficiency);
                }
            }

            // Update timeline front filter
            updateTimelineFrontFilter() {
                const filter = document.getElementById('timeline-front-filter');
                if (!filter) return;

                // Clear existing options except "Todas"
                filter.innerHTML = '<option value="all">Todas</option>';
                
                // Add front options
                this.state.fronts.forEach(front => {
                    const config = this.state.data.frontConfigs[front] || {};
                    const typeLabel = config.type === 'own' ? 'P' : 'T';
                    const option = document.createElement('option');
                    option.value = front;
                    option.textContent = `Frente ${front} (${typeLabel})`;
                    filter.appendChild(option);
                });
            }

            // Filter methods for charts
            filterIndividualChart(filterValue) {
                // This would filter the individual performance chart
                console.log('🔍 Filtrando gráfico individual:', filterValue);
                // Implementation depends on specific chart library features
            }

            filterTimelineChart(filterValue) {
                if (!this.charts.timelinePerformance) return;

                const chart = this.charts.timelinePerformance;
                
                if (filterValue === 'all') {
                    // Show all datasets
                    chart.data.datasets.forEach((dataset, index) => {
                        chart.setDatasetVisibility(index, true);
                    });
                } else {
                    // Show only selected front
                    chart.data.datasets.forEach((dataset, index) => {
                        const isSelectedFront = dataset.label.includes(`F${filterValue}`);
                        chart.setDatasetVisibility(index, isSelectedFront);
                    });
                }
                
                chart.update('none');
                console.log('🔍 Filtro de timeline aplicado:', filterValue);
            }

            // Update charts theme
            updateChartsTheme() {
                if (!this.isChartsLibraryLoaded) return;

                const isDark = document.documentElement.classList.contains('dark');
                const textColor = isDark ? '#E5E7EB' : '#374151';
                const gridColor = isDark ? 'rgba(75, 85, 99, 0.3)' : 'rgba(0, 0, 0, 0.08)';

                Object.keys(this.charts).forEach(chartKey => {
                    const chart = this.charts[chartKey];
                    if (chart && chart.options) {
                        // Update text colors
                        if (chart.options.plugins?.legend?.labels) {
                            chart.options.plugins.legend.labels.color = textColor;
                        }
                        
                        // Update scales colors
                        if (chart.options.scales) {
                            Object.keys(chart.options.scales).forEach(scaleKey => {
                                if (chart.options.scales[scaleKey].ticks) {
                                    chart.options.scales[scaleKey].ticks.color = textColor;
                                }
                                if (chart.options.scales[scaleKey].grid) {
                                    chart.options.scales[scaleKey].grid.color = gridColor;
                                }
                            });
                        }
                        
                        chart.update('none');
                    }
                });

                console.log('🎨 Tema dos gráficos atualizado para', isDark ? 'escuro' : 'claro');
            }

            // Period and Date Management
            switchTimePeriod(period) {
                if (this.state.activePeriod === period) return;

                // Save current data before switching
                this.saveData();

                this.state.activePeriod = period;
                
                // Update UI
                this.updatePeriodContent();
                this.generateTimePeriodButtons();
                this.state.ui.unsavedChanges = true;

                console.log('⏰ Período alterado para:', period);
                this.showToast(`Período alterado para ${this.getTimeSlotByPeriod(period)?.start || period}`, 'info');
            }

            getTimeSlotByPeriod(period) {
                return this.timeSlots.find(slot => slot.period === period);
            }

            updatePeriodContent() {
                const timeSlot = this.getTimeSlotByPeriod(this.state.activePeriod);
                if (!timeSlot) return;

                // Update period title
                const titleElement = document.getElementById('period-title');
                if (titleElement) {
                    titleElement.textContent = `Período: ${timeSlot.start}-${timeSlot.end}`;
                }

                // Update hour headers
                const hour1Header = document.getElementById('hour1-header');
                const hour2Header = document.getElementById('hour2-header');
                if (hour1Header && hour2Header) {
                    hour1Header.textContent = timeSlot.hours[0];
                    hour2Header.textContent = timeSlot.hours[1];
                }

                // Generate period data based on current input mode
                this.updateCurrentInputMode();
                this.updatePeriodSummary();
            }

            // NEW: Enhanced input mode management
            switchInputMode(mode) {
                this.state.activeInputMode = mode;

                // Update mode buttons
                document.querySelectorAll('.input-mode-btn').forEach(btn => {
                    btn.classList.remove('active', 'bg-primary', 'text-white');
                    btn.classList.add('text-gray-600', 'dark:text-gray-400');
                });

                const activeBtn = document.querySelector(`[data-mode="${mode}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active', 'bg-primary', 'text-white');
                    activeBtn.classList.remove('text-gray-600', 'dark:text-gray-400');
                }

                // Show/hide mode content
                document.querySelectorAll('.input-mode-content').forEach(content => {
                    content.classList.add('hidden');
                });

                const targetContent = document.getElementById(`${mode}-input-mode${mode === 'bulk' ? '-content' : ''}`);
                if (targetContent) {
                    targetContent.classList.remove('hidden');
                }

                // Update content based on mode
                this.updateCurrentInputMode();

                console.log('🔄 Modo de entrada alterado para:', mode);
                this.showToast(`Modo de entrada: ${this.getInputModeLabel(mode)}`, 'info');
            }

            getInputModeLabel(mode) {
                const labels = {
                    'table': 'Tabela Detalhada',
                    'cards': 'Cartões',
                    'bulk': 'Entrada Rápida'
                };
                return labels[mode] || mode;
            }

            updateCurrentInputMode() {
                switch (this.state.activeInputMode) {
                    case 'table':
                        this.generatePeriodDataTable();
                        break;
                    case 'cards':
                        this.generatePeriodDataCards();
                        break;
                    case 'bulk':
                        this.updateBulkInputMode();
                        break;
                }
            }

            generatePeriodDataTable() {
                const tableBody = document.getElementById('period-data-table');
                if (!tableBody) return;

                const timeSlot = this.getTimeSlotByPeriod(this.state.activePeriod);
                if (!timeSlot) return;

                tableBody.innerHTML = this.state.fronts.map(front => {
                    const frontData = this.state.data.periods[this.state.activePeriod].fronts[front];
                    const config = this.state.data.frontConfigs[front] || {};
                    
                    // Calculate potential for this period
                    let potentialHour1 = 0;
                    let potentialHour2 = 0;
                    if (config.hourlyPotential) {
                        potentialHour1 = parseFloat(config.hourlyPotential[timeSlot.hours[0]]) || 0;
                        potentialHour2 = parseFloat(config.hourlyPotential[timeSlot.hours[1]]) || 0;
                    }
                    const totalPotential = potentialHour1 + potentialHour2;
                    const missingDelivery = Math.max(0, totalPotential - frontData.total.delivery);
                    const efficiency = totalPotential > 0 ? (frontData.total.delivery / totalPotential) * 100 : 0;

                    const typeLabel = config.type === 'own' ? 'P' : 'T';
                    const typeColor = config.type === 'own' ? 'text-green-600' : 'text-orange-600';

                    return `
                        <tr class="table-row hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-300">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 h-8 w-8 ${config.type === 'own' ? 'bg-green-500' : 'bg-orange-500'} rounded-lg flex items-center justify-center text-white text-xs font-bold mr-3">
                                        ${typeLabel}
                                    </div>
                                    <div>
                                        <div class="text-sm font-semibold text-gray-900 dark:text-white">Frente ${front}</div>
                                        <div class="text-xs text-gray-500 dark:text-gray-400">${config.type === 'own' ? 'Própria' : 'Terceira'}</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="space-y-2">
                                    <div class="grid grid-cols-2 gap-2">
                                        <input type="number" 
                                            class="data-input w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:border-primary text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                            placeholder="Densidade" 
                                            data-front="${front}" 
                                            data-hour="hour1" 
                                            data-field="density" 
                                            value="${frontData.hour1.density || ''}"
                                            step="0.1">
                                        <input type="number" 
                                            class="data-input w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:border-primary text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                            placeholder="Viagens" 
                                            data-front="${front}" 
                                            data-hour="hour1" 
                                            data-field="trips" 
                                            value="${frontData.hour1.trips || ''}"
                                            step="1">
                                    </div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400 text-center">
                                        ${frontData.hour1.delivery.toFixed(1)}t
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="space-y-2">
                                    <div class="grid grid-cols-2 gap-2">
                                        <input type="number" 
                                            class="data-input w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:border-primary text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                            placeholder="Densidade" 
                                            data-front="${front}" 
                                            data-hour="hour2" 
                                            data-field="density" 
                                            value="${frontData.hour2.density || ''}"
                                            step="0.1">
                                        <input type="number" 
                                            class="data-input w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded focus:border-primary text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                            placeholder="Viagens" 
                                            data-front="${front}" 
                                            data-hour="hour2" 
                                            data-field="trips" 
                                            value="${frontData.hour2.trips || ''}"
                                            step="1">
                                    </div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400 text-center">
                                        ${frontData.hour2.delivery.toFixed(1)}t
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-center">
                                    <div class="text-lg font-bold text-primary">${frontData.total.delivery.toFixed(1)}t</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">${frontData.total.trips} viagens</div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-center">
                                    <div class="text-sm font-semibold text-red-600 dark:text-red-400">${missingDelivery.toFixed(1)}t</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">vs pot: ${totalPotential.toFixed(0)}t</div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-center">
                                    <div class="text-sm font-semibold ${efficiency >= 80 ? 'text-green-600' : efficiency >= 60 ? 'text-yellow-600' : 'text-red-600'}">${efficiency.toFixed(1)}%</div>
                                    <div class="mt-1 h-1 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                        <div class="h-full bg-gradient-to-r from-blue-500 to-blue-600 transition-all duration-1000" style="width: ${Math.min(efficiency, 100)}%"></div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

                console.log('📋 Tabela de dados do período gerada');
            }

            generatePeriodDataCards() {
                const container = document.getElementById('period-cards-container');
                if (!container) return;

                const timeSlot = this.getTimeSlotByPeriod(this.state.activePeriod);
                if (!timeSlot) return;

                container.innerHTML = this.state.fronts.map(front => {
                    const frontData = this.state.data.periods[this.state.activePeriod].fronts[front];
                    const config = this.state.data.frontConfigs[front] || {};
                    
                    // Calculate potential for this period
                    let potentialHour1 = 0;
                    let potentialHour2 = 0;
                    if (config.hourlyPotential) {
                        potentialHour1 = parseFloat(config.hourlyPotential[timeSlot.hours[0]]) || 0;
                        potentialHour2 = parseFloat(config.hourlyPotential[timeSlot.hours[1]]) || 0;
                    }
                    const totalPotential = potentialHour1 + potentialHour2;
                    const efficiency = totalPotential > 0 ? (frontData.total.delivery / totalPotential) * 100 : 0;

                    const typeColor = config.type === 'own' ? 'from-green-500 to-green-600' : 'from-orange-500 to-orange-600';
                    const typeBadge = config.type === 'own' ? 'P' : 'T';

                    return `
                        <div class="period-input-card rounded-xl p-6 shadow-lg">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-3">
                                    <div class="relative w-12 h-12 bg-gradient-to-br ${typeColor} rounded-xl flex items-center justify-center text-white font-bold text-lg shadow-lg">
                                        F
                                        <div class="front-type-badge ${config.type === 'own' ? 'front-type-own' : 'front-type-third'}">${typeBadge}</div>
                                    </div>
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-900 dark:text-white">Frente ${front}</h3>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">${config.type === 'own' ? 'Própria' : 'Terceira'}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold text-primary">${frontData.total.delivery.toFixed(1)}t</div>
                                    <div class="text-xs text-gray-500 dark:text-gray-400">${efficiency.toFixed(1)}% eficiência</div>
                                </div>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">${timeSlot.hours[0]}</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Densidade (t/viag)</label>
                                            <input type="number" 
                                                class="data-input w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                                data-front="${front}" 
                                                data-hour="hour1" 
                                                data-field="density" 
                                                value="${frontData.hour1.density || ''}"
                                                step="0.1">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Viagens</label>
                                            <input type="number" 
                                                class="data-input w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                                data-front="${front}" 
                                                data-hour="hour1" 
                                                data-field="trips" 
                                                value="${frontData.hour1.trips || ''}"
                                                step="1">
                                        </div>
                                    </div>
                                    <div class="mt-2 text-center text-sm text-gray-600 dark:text-gray-400">
                                        Entrega: ${frontData.hour1.delivery.toFixed(1)}t
                                    </div>
                                </div>

                                <div>
                                    <h4 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">${timeSlot.hours[1]}</h4>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div>
                                            <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Densidade (t/viag)</label>
                                            <input type="number" 
                                                class="data-input w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                                data-front="${front}" 
                                                data-hour="hour2" 
                                                data-field="density" 
                                                value="${frontData.hour2.density || ''}"
                                                step="0.1">
                                        </div>
                                        <div>
                                            <label class="block text-xs text-gray-600 dark:text-gray-400 mb-1">Viagens</label>
                                            <input type="number" 
                                                class="data-input w-full px-3 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-white" 
                                                data-front="${front}" 
                                                data-hour="hour2" 
                                                data-field="trips" 
                                                value="${frontData.hour2.trips || ''}"
                                                step="1">
                                        </div>
                                    </div>
                                    <div class="mt-2 text-center text-sm text-gray-600 dark:text-gray-400">
                                        Entrega: ${frontData.hour2.delivery.toFixed(1)}t
                                    </div>
                                </div>

                                <div class="pt-3 border-t border-gray-200 dark:border-gray-700">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-600 dark:text-gray-400">Eficiência vs Potencial</span>
                                        <span class="text-sm font-semibold text-primary">${efficiency.toFixed(1)}%</span>
                                    </div>
                                    <div class="mt-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                        <div class="h-full bg-gradient-to-r from-primary to-primary-600 transition-all duration-1000" style="width: ${Math.min(efficiency, 100)}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                console.log('🃏 Cartões de dados do período gerados');
            }

            updateBulkInputMode() {
                // This mode allows applying default values to all fronts quickly
                // The UI is already generated in HTML, just needs to be functional
                console.log('⚡ Modo de entrada rápida ativo');
            }

            // NEW: Enhanced bulk input methods
            applyBulkInput(hour) {
                const densityInput = document.getElementById(`bulk-density-${hour}`);
                const tripsInput = document.getElementById(`bulk-trips-${hour}`);
                
                if (!densityInput || !tripsInput) return;

                const density = parseFloat(densityInput.value) || 0;
                const trips = parseInt(tripsInput.value) || 0;

                if (density <= 0 || trips <= 0) {
                    this.showToast('Por favor, digite valores válidos para densidade e viagens', 'warning');
                    return;
                }

                let updated = 0;
                this.state.fronts.forEach(front => {
                    const frontData = this.state.data.periods[this.state.activePeriod].fronts[front];
                    if (frontData) {
                        frontData[hour].density = density;
                        frontData[hour].trips = trips;
                        frontData[hour].delivery = density * trips; // CORRECTED FORMULA
                        updated++;
                    }
                });

                // Recalculate totals
                this.recalculatePeriodTotals();
                this.updatePeriodSummary();
                this.updateAllRealData();
                this.state.ui.unsavedChanges = true;

                this.showToast(`✅ Entrada rápida aplicada para ${updated} frentes na ${hour === 'hour1' ? 'primeira' : 'segunda'} hora`, 'success');
                
                // Clear inputs
                densityInput.value = '';
                tripsInput.value = '';
            }

            // NEW: Copy previous period data
            copyPreviousPeriod() {
                const currentIndex = this.timeSlots.findIndex(slot => slot.period === this.state.activePeriod);
                const prevIndex = currentIndex > 0 ? currentIndex - 1 : this.timeSlots.length - 1;
                const prevPeriod = this.timeSlots[prevIndex].period;

                let copiedFronts = 0;
                this.state.fronts.forEach(front => {
                    const prevData = this.state.data.periods[prevPeriod].fronts[front];
                    const currentData = this.state.data.periods[this.state.activePeriod].fronts[front];
                    
                    if (prevData && currentData && prevData.total.trips > 0) {
                        currentData.hour1 = { ...prevData.hour1 };
                        currentData.hour2 = { ...prevData.hour2 };
                        currentData.total = { ...prevData.total };
                        copiedFronts++;
                    }
                });

                if (copiedFronts > 0) {
                    this.updateCurrentInputMode();
                    this.updatePeriodSummary();
                    this.updateAllRealData();
                    this.state.ui.unsavedChanges = true;
                    this.showToast(`📋 Dados copiados de ${copiedFronts} frentes do período anterior`, 'success');
                } else {
                    this.showToast('Nenhum dado encontrado no período anterior para copiar', 'warning');
                }
            }

            // NEW: Validation methods
            validateAllInputs() {
                let validInputs = 0;
                let totalInputs = 0;
                const issues = [];

                this.state.fronts.forEach(front => {
                    const frontData = this.state.data.periods[this.state.activePeriod].fronts[front];
                    
                    ['hour1', 'hour2'].forEach(hour => {
                        totalInputs += 2; // density and trips
                        
                        if (frontData[hour].density > 0 && frontData[hour].trips > 0) {
                            validInputs += 2;
                        } else if (frontData[hour].density > 0 || frontData[hour].trips > 0) {
                            validInputs += 1;
                            issues.push(`Frente ${front} - ${hour}: Dados incompletos`);
                        }
                    });
                });

                const validationPercentage = totalInputs > 0 ? (validInputs / totalInputs) * 100 : 0;

                if (issues.length > 0) {
                    console.log('⚠️ Problemas de validação encontrados:', issues);
                    this.showToast(`Validação: ${validationPercentage.toFixed(1)}% completa. ${issues.length} problemas encontrados.`, 'warning');
                } else {
                    this.showToast(`✅ Validação concluída: ${validationPercentage.toFixed(1)}% dos dados estão completos`, 'success');
                }

                return { validationPercentage, issues };
            }

            clearPeriodInputs() {
                if (!confirm('Tem certeza que deseja limpar todos os dados deste período?')) {
                    return;
                }

                this.state.fronts.forEach(front => {
                    const frontData = this.state.data.periods[this.state.activePeriod].fronts[front];
                    if (frontData) {
                        frontData.hour1 = { density: 0, trips: 0, delivery: 0 };
                        frontData.hour2 = { density: 0, trips: 0, delivery: 0 };
                        frontData.total = { density: 0, trips: 0, delivery: 0, efficiency: 0 };
                    }
                });

                this.updateCurrentInputMode();
                this.updatePeriodSummary();
                this.updateAllRealData();
                this.state.ui.unsavedChanges = true;

                this.showToast('🧹 Dados do período limpos', 'info');
            }

            // Input handling with debounce
            handleInputChangeWithDebounce(event) {
                const { target } = event;
                const front = target.dataset.front;
                const hour = target.dataset.hour;
                const field = target.dataset.field;

                if (!front || !hour || !field) return;

                // Clear previous timer
                const timerId = `${front}-${hour}-${field}`;
                if (this.state.debounceTimers[timerId]) {
                    clearTimeout(this.state.debounceTimers[timerId]);
                }

                // Set new timer
                this.state.debounceTimers[timerId] = setTimeout(() => {
                    this.handleInputChange(front, hour, field, target.value);
                }, this.state.config.inputDebounceDelay);
            }

            handleInputChange(front, hour, field, value) {
                const frontData = this.state.data.periods[this.state.activePeriod].fronts[front];
                if (!frontData) return;

                const numValue = parseFloat(value) || 0;
                frontData[hour][field] = numValue;

                // Calculate delivery using CORRECTED formula: density × trips (NO extra multiplier)
                if (field === 'density' || field === 'trips') {
                    frontData[hour].delivery = frontData[hour].density * frontData[hour].trips;
                }

                // Recalculate period totals
                this.recalculatePeriodTotals();
                
                // Update displays
                this.updatePeriodSummary();
                this.updateAllRealData();
                this.updateQuickStats();
                this.updateActiveEntriesCount();
                this.updatePeriodProgress();

                // Mark as having changes
                this.state.ui.unsavedChanges = true;

                // Update input validation styling
                this.updateInputValidation(front, hour);

                console.log(`📝 Dados atualizados: F${front} ${hour} ${field} = ${numValue}`);
            }

            updateInputValidation(front, hour) {
                const frontData = this.state.data.periods[this.state.activePeriod].fronts[front];
                if (!frontData) return;

                const hasData = frontData[hour].density > 0 && frontData[hour].trips > 0;
                const hasPartialData = frontData[hour].density > 0 || frontData[hour].trips > 0;

                // Find input elements for this front and hour
                const inputs = document.querySelectorAll(`[data-front="${front}"][data-hour="${hour}"]`);
                inputs.forEach(input => {
                    input.classList.remove('input-success', 'input-warning', 'input-error');
                    
                    if (hasData) {
                        input.classList.add('input-success');
                    } else if (hasPartialData) {
                        input.classList.add('input-warning');
                    }
                });
            }

            recalculatePeriodTotals() {
                this.state.fronts.forEach(front => {
                    const frontData = this.state.data.periods[this.state.activePeriod].fronts[front];
                    if (frontData) {
                        // Calculate totals
                        frontData.total.density = (frontData.hour1.density + frontData.hour2.density) / 2;
                        frontData.total.trips = frontData.hour1.trips + frontData.hour2.trips;
                        frontData.total.delivery = frontData.hour1.delivery + frontData.hour2.delivery;

                        // Calculate efficiency vs potential
                        const config = this.state.data.frontConfigs[front];
                        if (config?.hourlyPotential && frontData.total.trips > 0) {
                            const timeSlot = this.getTimeSlotByPeriod(this.state.activePeriod);
                            if (timeSlot) {
                                let potential = 0;
                                timeSlot.hours.forEach(hour => {
                                    potential += parseFloat(config.hourlyPotential[hour]) || 0;
                                });
                                frontData.total.efficiency = potential > 0 ? (frontData.total.delivery / potential) * 100 : 0;
                            }
                        }
                    }
                });
            }

            updatePeriodSummary() {
                let totalDelivery = 0;
                let totalTrips = 0;
                let totalPotential = 0;
                let frontsWithData = 0;

                this.state.fronts.forEach(front => {
                    const frontData = this.state.data.periods[this.state.activePeriod].fronts[front];
                    if (frontData) {
                        totalDelivery += frontData.total.delivery;
                        totalTrips += frontData.total.trips;

                        if (frontData.total.trips > 0) {
                            frontsWithData++;
                            const config = this.state.data.frontConfigs[front];
                            if (config?.hourlyPotential) {
                                const timeSlot = this.getTimeSlotByPeriod(this.state.activePeriod);
                                if (timeSlot) {
                                    timeSlot.hours.forEach(hour => {
                                        totalPotential += parseFloat(config.hourlyPotential[hour]) || 0;
                                    });
                                }
                            }
                        }
                    }
                });

                const totalMissing = Math.max(0, totalPotential - totalDelivery);
                const efficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;

                // Update summary elements
                this.updateElement('summary-delivered', `${totalDelivery.toFixed(1)}t`);
                this.updateElement('summary-trips', totalTrips.toString());
                this.updateElement('summary-efficiency', `${efficiency.toFixed(1)}%`);
                this.updateElement('summary-potential', `${totalPotential.toFixed(1)}t`);
                this.updateElement('summary-missing', `${totalMissing.toFixed(1)}t`);

                // Update progress bars
                this.updateProgressBar('summary-delivered-progress', totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0);
                this.updateProgressBar('summary-trips-progress', totalTrips > 0 ? 75 : 0); // Arbitrary visual
                this.updateProgressBar('summary-efficiency-progress', efficiency);
                this.updateProgressBar('summary-potential-progress', 100);
                this.updateProgressBar('summary-missing-progress', totalPotential > 0 ? (totalMissing / totalPotential) * 100 : 0);

                // Update period totals in header
                this.updateElement('period-total-trips', totalTrips.toString());
                this.updateElement('period-total-delivery', `${totalDelivery.toFixed(1)}t`);
                this.updateElement('period-total-potential', `${totalPotential.toFixed(1)}t`);
                this.updateElement('period-total-missing', `${totalMissing.toFixed(1)}t`);

                // Update period summary title
                const timeSlot = this.getTimeSlotByPeriod(this.state.activePeriod);
                if (timeSlot) {
                    this.updateElement('period-summary-title', `Resumo do Período ${timeSlot.start}-${timeSlot.end}`);
                }
            }

            updateElement(id, content) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = content;
                }
            }

            updateProgressBar(id, percentage) {
                const element = document.getElementById(id);
                if (element) {
                    element.style.width = `${Math.min(Math.max(percentage, 0), 100)}%`;
                }
            }

            // Update quick stats for dashboard
            updateQuickStats() {
                const stats = this.calculateAllPeriodStats();

                // Update individual quick stats
                this.updateElement('quick-total-periods', stats.activePeriods.toString());
                this.updateElement('quick-total-delivery', `${stats.totalDelivery.toFixed(1)}t`);
                this.updateElement('quick-total-trips', stats.totalTrips.toString());
                this.updateElement('quick-avg-density', stats.avgDensity.toFixed(1));
                this.updateElement('quick-total-potential', `${stats.totalPotential.toFixed(1)}t`);
                this.updateElement('quick-total-missing', `${stats.totalMissing.toFixed(1)}t`);
                this.updateElement('quick-overall-efficiency', `${stats.overallEfficiency.toFixed(1)}%`);
                this.updateElement('quick-trucks-hour', stats.trucksPerHour.toFixed(1));
            }

            calculateAllPeriodStats() {
                let totalDelivery = 0;
                let totalTrips = 0;
                let totalPotential = 0;
                let activePeriods = 0;
                let totalDensitySum = 0;
                let densityCount = 0;

                this.timeSlots.forEach(slot => {
                    let periodHasData = false;
                    let periodDelivery = 0;
                    let periodTrips = 0;
                    let periodPotential = 0;

                    this.state.fronts.forEach(front => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData && frontData.total.trips > 0) {
                            periodHasData = true;
                            periodDelivery += frontData.total.delivery;
                            periodTrips += frontData.total.trips;

                            // Add density values for average calculation
                            if (frontData.hour1.density > 0) {
                                totalDensitySum += frontData.hour1.density;
                                densityCount++;
                            }
                            if (frontData.hour2.density > 0) {
                                totalDensitySum += frontData.hour2.density;
                                densityCount++;
                            }

                            // Calculate potential only for periods with data
                            const config = this.state.data.frontConfigs[front];
                            if (config?.hourlyPotential) {
                                slot.hours.forEach(hour => {
                                    periodPotential += parseFloat(config.hourlyPotential[hour]) || 0;
                                });
                            }
                        }
                    });

                    if (periodHasData) {
                        activePeriods++;
                        totalDelivery += periodDelivery;
                        totalTrips += periodTrips;
                        totalPotential += periodPotential;
                    }
                });

                const totalMissing = Math.max(0, totalPotential - totalDelivery);
                const overallEfficiency = totalPotential > 0 ? (totalDelivery / totalPotential) * 100 : 0;
                const avgDensity = densityCount > 0 ? totalDensitySum / densityCount : 0;
                const trucksPerHour = activePeriods > 0 ? totalTrips / (activePeriods * 2) : 0; // 2 hours per period

                return {
                    totalDelivery,
                    totalTrips,
                    totalPotential,
                    totalMissing,
                    activePeriods,
                    overallEfficiency,
                    avgDensity,
                    trucksPerHour
                };
            }

            // Update all real data throughout the interface
            updateAllRealData() {
                // Calculate separated data by front type
                const separatedData = this.calculateSeparatedData();
                const allStats = this.calculateAllPeriodStats();

                // Update dashboard cards with separated data
                this.updateElement('total-delivered', `${separatedData.total.delivered.toFixed(1)} t`);
                this.updateElement('own-delivered', `${separatedData.own.delivered.toFixed(1)} t`);
                this.updateElement('third-delivered', `${separatedData.third.delivered.toFixed(1)} t`);
                
                this.updateElement('total-missing', `${separatedData.total.missing.toFixed(1)} t`);
                this.updateElement('own-missing', `${separatedData.own.missing.toFixed(1)} t`);
                this.updateElement('third-missing', `${separatedData.third.missing.toFixed(1)} t`);
                
                this.updateElement('overall-efficiency', `${separatedData.total.efficiency.toFixed(1)}%`);
                this.updateElement('own-efficiency', `${separatedData.own.efficiency.toFixed(1)}%`);
                this.updateElement('third-efficiency', `${separatedData.third.efficiency.toFixed(1)}%`);

                this.updateElement('avg-trucks-hour', allStats.trucksPerHour.toFixed(1));
                this.updateElement('active-periods-count', allStats.activePeriods.toString());

                // Update progress bars
                const dailyGoal = this.state.data.dailyGoals.delivery;
                const goalProgress = dailyGoal > 0 ? (separatedData.total.delivered / dailyGoal) * 100 : 0;
                
                this.updateProgressBar('delivery-progress', goalProgress);
                this.updateProgressBar('own-progress', separatedData.own.efficiency);
                this.updateProgressBar('third-progress', separatedData.third.efficiency);
                this.updateProgressBar('missing-progress', separatedData.total.potential > 0 ? (separatedData.total.missing / separatedData.total.potential) * 100 : 0);
                this.updateProgressBar('own-missing-progress', separatedData.own.potential > 0 ? (separatedData.own.missing / separatedData.own.potential) * 100 : 0);
                this.updateProgressBar('third-missing-progress', separatedData.third.potential > 0 ? (separatedData.third.missing / separatedData.third.potential) * 100 : 0);
                this.updateProgressBar('trucks-progress', Math.min((allStats.trucksPerHour / 50) * 100, 100)); // Assuming 50 as max expected

                // Update trends and percentages
                this.updateElement('delivery-percentage', `${goalProgress.toFixed(1)}%`);
                this.updateElement('missing-percentage', `${separatedData.total.potential > 0 ? (separatedData.total.missing / separatedData.total.potential * 100).toFixed(1) : '0'}%`);
                this.updateElement('own-missing-percentage', `${separatedData.own.potential > 0 ? (separatedData.own.missing / separatedData.own.potential * 100).toFixed(1) : '0'}%`);
                this.updateElement('third-missing-percentage', `${separatedData.third.potential > 0 ? (separatedData.third.missing / separatedData.third.potential * 100).toFixed(1) : '0'}%`);

                // Update efficiency circle
                const efficiencyCircle = document.getElementById('efficiency-circle');
                if (efficiencyCircle) {
                    const circumference = 100;
                    const progress = (separatedData.total.efficiency / 100) * circumference;
                    efficiencyCircle.style.strokeDasharray = `${progress}, ${circumference}`;
                }

                // Update header stats
                this.updateElement('header-total-delivered', separatedData.total.delivered.toFixed(0));
                this.updateElement('header-missing', separatedData.total.missing.toFixed(0));
                this.updateElement('header-efficiency', separatedData.total.efficiency.toFixed(0));
                this.updateElement('header-trucks-hour', allStats.trucksPerHour.toFixed(1));

                // Update performance table
                this.generateDashboardTable();

                // Update charts if they exist
                this.updateCharts();

                // Update period summaries and progress
                this.updatePeriodSummaries();
                this.updatePeriodProgress();

                console.log('🔄 Todos os dados reais atualizados com separação por tipo de frente');
            }

            updateCharts() {
                if (!this.isChartsLibraryLoaded) return;

                try {
                    // Update performance chart
                    if (this.charts.performance) {
                        const realData = this.getRealPerformanceData();
                        this.charts.performance.data.datasets[0].data = realData.delivered;
                        this.charts.performance.data.datasets[1].data = realData.potential;
                        this.charts.performance.update('none');
                    }

                    // Update efficiency chart
                    if (this.charts.efficiency) {
                        const realEfficiencyData = this.getRealEfficiencyData();
                        this.charts.efficiency.data.datasets[0].data = realEfficiencyData.efficiencies;
                        
                        // Update labels with type indicators
                        this.charts.efficiency.data.labels = this.state.fronts.map(front => {
                            const config = this.state.data.frontConfigs[front] || {};
                            const typeLabel = config.type === 'own' ? 'P' : 'T';
                            return `F${front} (${typeLabel})`;
                        });
                        
                        this.charts.efficiency.update('none');
                    }

                    // Update individual performance chart
                    if (this.charts.individualPerformance) {
                        const individualData = this.getIndividualPerformanceData();
                        this.charts.individualPerformance.data.labels = individualData.labels;
                        this.charts.individualPerformance.data.datasets[0].data = individualData.delivered;
                        this.charts.individualPerformance.data.datasets[1].data = individualData.potential;
                        this.charts.individualPerformance.data.datasets[2].data = individualData.goals;
                        this.charts.individualPerformance.update('none');
                    }

                    // Update timeline performance chart
                    if (this.charts.timelinePerformance) {
                        const timelineData = this.getTimelinePerformanceData();
                        this.charts.timelinePerformance.data.datasets = timelineData.datasets;
                        this.charts.timelinePerformance.update('none');
                    }

                    // Update performance cards
                    this.generateIndividualPerformanceCards();

                } catch (error) {
                    console.error('❌ Erro ao atualizar gráficos:', error);
                }
            }

            generateDashboardTable() {
                const tableBody = document.getElementById('performance-table');
                if (!tableBody) return;

                tableBody.innerHTML = this.state.fronts.map(front => {
                    const frontTotals = this.calculateFrontTotals(front);
                    const config = this.state.data.frontConfigs[front] || {};
                    const efficiency = frontTotals.potential > 0 ? (frontTotals.delivered / frontTotals.potential) * 100 : 0;
                    const goalProgress = config.dailyGoal > 0 ? (frontTotals.delivered / config.dailyGoal) * 100 : 0;
                    
                    // Calculate trucks per hour for this front
                    let totalActiveHours = 0;
                    this.timeSlots.forEach(slot => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData && frontData.total.trips > 0) {
                            totalActiveHours += 2; // 2 hours per period
                        }
                    });
                    const trucksPerHour = totalActiveHours > 0 ? frontTotals.trips / totalActiveHours : 0;

                    const typeColor = config.type === 'own' ? 'text-green-600' : 'text-orange-600';
                    const typeBg = config.type === 'own' ? 'bg-green-100 dark:bg-green-900/20' : 'bg-orange-100 dark:bg-orange-900/20';
                    const typeLabel = config.type === 'own' ? 'Própria' : 'Terceira';

                    const efficiencyColor = efficiency >= 80 ? 'text-green-600' : 
                                          efficiency >= 60 ? 'text-yellow-600' : 'text-red-600';

                    const statusBadge = efficiency >= 90 ? 'bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400' :
                                      efficiency >= 75 ? 'bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400' :
                                      efficiency >= 60 ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400' :
                                      'bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400';

                    const statusText = efficiency >= 90 ? 'Excelente' :
                                     efficiency >= 75 ? 'Bom' :
                                     efficiency >= 60 ? 'Regular' : 'Atenção';

                    return `
                        <tr class="table-row hover:bg-gray-50 dark:hover:bg-gray-700 transition-all duration-300">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 h-10 w-10 ${config.type === 'own' ? 'bg-green-500' : 'bg-orange-500'} rounded-xl flex items-center justify-center text-white text-sm font-bold mr-3 shadow-lg">
                                        F
                                    </div>
                                    <div>
                                        <div class="text-sm font-semibold text-gray-900 dark:text-white">Frente ${front}</div>
                                        <div class="text-xs ${typeColor} ${typeBg} px-2 py-1 rounded-full inline-block">${typeLabel}</div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm font-semibold text-gray-900 dark:text-white">${frontTotals.delivered.toFixed(1)}t</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">${frontTotals.trips} viagens</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm font-semibold text-red-600 dark:text-red-400">${frontTotals.missing.toFixed(1)}t</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">não entregue</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm font-semibold text-blue-600 dark:text-blue-400">${frontTotals.potential.toFixed(1)}t</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">fórmula corrigida</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm font-semibold text-gray-900 dark:text-white">${(config.dailyGoal || 0).toFixed(0)}t</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">${goalProgress.toFixed(1)}% atingido</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm font-semibold ${efficiencyColor}">${efficiency.toFixed(1)}%</div>
                                <div class="mt-1 h-1 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-green-500 to-green-600 transition-all duration-1000" style="width: ${Math.min(efficiency, 100)}%"></div>
                                </div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm font-semibold text-gray-900 dark:text-white">${frontTotals.trips}</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">total 24h</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm font-semibold text-purple-600 dark:text-purple-400">${trucksPerHour.toFixed(1)}</div>
                                <div class="text-xs text-gray-500 dark:text-gray-400">por hora ativa</div>
                            </td>
                            <td class="px-6 py-4">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusBadge}">
                                    ${statusText}
                                </span>
                            </td>
                            <td class="px-6 py-4">
                                <div class="flex items-center space-x-2">
                                    <button class="p-1 text-gray-400 hover:text-primary transition-colors tooltip" data-tooltip="Ver detalhes" onclick="ggomesSystem.showFrontDetails('${front}')">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                        </svg>
                                    </button>
                                    <button class="p-1 text-gray-400 hover:text-primary transition-colors tooltip" data-tooltip="Configurar" onclick="ggomesSystem.showFrontConfigModal('${front}')">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

                // Update table stats
                this.updateElement('table-total', this.state.fronts.length.toString());
                this.updateElement('table-showing', `1-${this.state.fronts.length}`);
            }

            updateActiveEntriesCount() {
                let activeEntries = 0;
                this.timeSlots.forEach(slot => {
                    this.state.fronts.forEach(front => {
                        const frontData = this.state.data.periods[slot.period].fronts[front];
                        if (frontData && frontData.total.trips > 0) {
                            activeEntries++;
                        }
                    });
                });

                console.log(`📊 Entradas ativas: ${activeEntries}`);
            }

            // Date Navigation
            navigateDate(direction) {
                if (this.state.ui.dateNavigationInProgress) return;

                this.state.ui.dateNavigationInProgress = true;
                const loadingIndicator = document.getElementById('date-loading-indicator');
                if (loadingIndicator) {
                    loadingIndicator.classList.remove('hidden');
                }

                // Save current data before switching
                this.saveData();

                // Calculate new date
                const currentDate = new Date(this.state.currentDate);
                currentDate.setDate(currentDate.getDate() + direction);
                this.state.currentDate = currentDate.toISOString().split('T')[0];

                // Load data for new date
                setTimeout(() => {
                    this.loadDateSpecificData();
                    this.updateDateDisplay();
                    this.updateAllRealData();
                    this.updateQuickStats();
                    this.updateActiveEntriesCount();
                    this.updatePeriodProgress();
                    this.generateTimePeriodButtons();
                    this.updateCurrentInputMode();
                    this.updateCharts();

                    if (loadingIndicator) {
                        loadingIndicator.classList.add('hidden');
                    }
                    this.state.ui.dateNavigationInProgress = false;

                    const dateStr = this.formatDate(this.state.currentDate);
                    this.showToast(`📅 Data alterada para ${dateStr}`, 'info');
                }, 300);
            }

            updateDateDisplay() {
                const dateElement = document.getElementById('date-text');
                if (dateElement) {
                    const today = new Date().toISOString().split('T')[0];
                    if (this.state.currentDate === today) {
                        dateElement.textContent = 'Hoje';
                    } else {
                        dateElement.textContent = this.formatDate(this.state.currentDate);
                    }
                }
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }

            showDatePicker() {
                // Create a simple date input for date selection
                const input = document.createElement('input');
                input.type = 'date';
                input.value = this.state.currentDate;
                input.style.position = 'absolute';
                input.style.top = '-9999px';
                document.body.appendChild(input);

                input.addEventListener('change', (e) => {
                    if (e.target.value) {
                        this.state.currentDate = e.target.value;
                        this.saveData();
                        this.loadDateSpecificData();
                        this.updateDateDisplay();
                        this.updateAllRealData();
                        this.updateQuickStats();
                        this.updateActiveEntriesCount();
                        this.updatePeriodProgress();
                        this.generateTimePeriodButtons();
                        this.updateCurrentInputMode();
                        this.updateCharts();
                        
                        const dateStr = this.formatDate(this.state.currentDate);
                        this.showToast(`📅 Data selecionada: ${dateStr}`, 'info');
                    }
                    document.body.removeChild(input);
                });

                input.click();
            }

            // Front Management
            showManageFrontsModal() {
                const modal = document.getElementById('manage-fronts-modal');
                if (modal) {
                    modal.classList.remove('hidden');
                    this.updateFrontsList();
                    
                    // Focus on input
                    const input = document.getElementById('new-front-input');
                    if (input) {
                        setTimeout(() => input.focus(), 100);
                    }
                }
            }

            hideManageFrontsModal() {
                const modal = document.getElementById('manage-fronts-modal');
                if (modal) {
                    modal.classList.add('hidden');
                }
            }

            updateFrontsList() {
                const list = document.getElementById('fronts-list');
                if (!list) return;

                if (this.state.fronts.length === 0) {
                    list.innerHTML = `
                        <li class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                            </svg>
                            <p>Nenhuma frente configurada</p>
                            <p class="text-xs mt-2">Adicione uma frente para começar</p>
                        </li>
                    `;
                    return;
                }

                list.innerHTML = this.state.fronts.map(front => {
                    const config = this.state.data.frontConfigs[front] || {};
                    const typeLabel = config.type === 'own' ? 'Própria' : 'Terceira';
                    const typeColor = config.type === 'own' ? 'text-green-600' : 'text-orange-600';
                    const typeBg = config.type === 'own' ? 'bg-green-100 dark:bg-green-900/20' : 'bg-orange-100 dark:bg-orange-900/20';
                    
                    // Calculate current status
                    const frontTotals = this.calculateFrontTotals(front);
                    const hasData = frontTotals.trips > 0;
                    
                    return `
                        <li class="px-4 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 ${config.type === 'own' ? 'bg-green-500' : 'bg-orange-500'} rounded-lg flex items-center justify-center text-white text-xs font-bold">
                                    F
                                </div>
                                <div>
                                    <div class="text-sm font-semibold text-gray-900 dark:text-white">Frente ${front}</div>
                                    <div class="flex items-center space-x-2">
                                        <span class="text-xs ${typeColor} ${typeBg} px-2 py-1 rounded-full">${typeLabel}</span>
                                        ${hasData ? '<span class="text-xs text-green-600 dark:text-green-400">● Com dados</span>' : '<span class="text-xs text-gray-500 dark:text-gray-400">○ Sem dados</span>'}
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button class="p-1 text-gray-400 hover:text-primary transition-colors tooltip" data-tooltip="Configurar" onclick="ggomesSystem.showFrontConfigModal('${front}')">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                </button>
                                <button class="p-1 text-red-400 hover:text-red-600 transition-colors tooltip" data-tooltip="Remover frente" onclick="ggomesSystem.removeFront('${front}')">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </li>
                    `;
                }).join('');
            }

            addFront() {
                const input = document.getElementById('new-front-input');
                if (!input) return;

                const frontNumber = input.value.trim();
                if (!frontNumber) {
                    this.showToast('Digite um número de frente válido', 'warning');
                    return;
                }

                if (this.state.fronts.includes(frontNumber)) {
                    this.showToast('Esta frente já existe', 'warning');
                    input.value = '';
                    return;
                }

                // Add to fronts list
                this.state.fronts.push(frontNumber);

                // Initialize data structures for all periods
                this.timeSlots.forEach(slot => {
                    if (!this.state.data.periods[slot.period]) {
                        this.state.data.periods[slot.period] = { fronts: {} };
                    }
                    this.state.data.periods[slot.period].fronts[frontNumber] = {
                        hour1: { density: 0, trips: 0, delivery: 0 },
                        hour2: { density: 0, trips: 0, delivery: 0 },
                        total: { density: 0, trips: 0, delivery: 0, efficiency: 0 }
                    };
                });

                // Initialize configuration
                this.state.data.frontConfigs[frontNumber] = {
                    type: 'own', // Default to own
                    dailyGoal: this.state.config.defaultFrontGoal,
                    defaultPotential: this.state.config.defaultPotentialPerHour,
                    hourlyPotential: {},
                    notes: ''
                };

                // Initialize hourly potential for all 24 hours
                this.hours24.forEach(hour => {
                    this.state.data.frontConfigs[frontNumber].hourlyPotential[hour] = this.state.config.defaultPotentialPerHour;
                });

                // Update global goals
                this.updateGlobalGoals();

                // Update UI
                this.updateFrontsList();
                this.generateFrontConfigCards();
                this.updateCurrentInputMode();
                this.updateAllRealData();
                this.updateCharts();
                this.updateTimelineFrontFilter();

                // Mark as having changes
                this.state.ui.unsavedChanges = true;

                // Clear input
                input.value = '';

                this.showToast(`✅ Frente ${frontNumber} adicionada com sucesso`, 'success');
                console.log(`➕ Frente ${frontNumber} adicionada`);
            }

            removeFront(front) {
                if (!confirm(`Tem certeza que deseja remover a Frente ${front}? Todos os dados serão perdidos.`)) {
                    return;
                }

                // Remove from fronts list
                this.state.fronts = this.state.fronts.filter(f => f !== front);

                // Remove data from all periods
                this.timeSlots.forEach(slot => {
                    if (this.state.data.periods[slot.period] && this.state.data.periods[slot.period].fronts[front]) {
                        delete this.state.data.periods[slot.period].fronts[front];
                    }
                });

                // Remove configuration
                if (this.state.data.frontConfigs[front]) {
                    delete this.state.data.frontConfigs[front];
                }

                // Update global goals
                this.updateGlobalGoals();

                // Update UI
                this.updateFrontsList();
                this.generateFrontConfigCards();
                this.updateCurrentInputMode();
                this.updateAllRealData();
                this.updateCharts();
                this.updateTimelineFrontFilter();

                // Mark as having changes
                this.state.ui.unsavedChanges = true;

                this.showToast(`🗑️ Frente ${front} removida`, 'info');
                console.log(`➖ Frente ${front} removida`);
            }

            // Front Configuration Modal
            showFrontConfigModal(front) {
                this.state.ui.currentConfigFront = front;
                const modal = document.getElementById('front-config-modal');
                if (!modal) return;

                // Update modal title
                const title = document.getElementById('config-modal-title');
                if (title) {
                    title.textContent = `Configurar Frente ${front}`;
                }

                // Load current configuration
                const config = this.state.data.frontConfigs[front] || {};
                
                // General tab
                const typeSelect = document.getElementById('front-type');
                const goalInput = document.getElementById('front-daily-goal');
                const potentialInput = document.getElementById('front-default-potential');
                const notesInput = document.getElementById('front-notes');

                if (typeSelect) typeSelect.value = config.type || 'own';
                if (goalInput) goalInput.value = config.dailyGoal || '';
                if (potentialInput) potentialInput.value = config.defaultPotential || '';
                if (notesInput) notesInput.value = config.notes || '';

                // Generate hourly potential inputs
                this.generateHourlyPotentialInputs(front);

                // Show modal
                modal.classList.remove('hidden');

                // Focus on first input
                setTimeout(() => {
                    if (typeSelect) typeSelect.focus();
                }, 100);
            }

            showNewFrontConfigModal() {
                this.showManageFrontsModal();
            }

            hideFrontConfigModal() {
                const modal = document.getElementById('front-config-modal');
                if (modal) {
                    modal.classList.add('hidden');
                }
                this.state.ui.currentConfigFront = null;
            }

            generateHourlyPotentialInputs(front) {
                const container = document.getElementById('hourly-potential-grid');
                if (!container) return;

                const config = this.state.data.frontConfigs[front] || {};

                container.innerHTML = this.hours24.map(hour => {
                    const currentPotential = config.hourlyPotential?.[hour] || config.defaultPotential || 0;
                    
                    return `
                        <div>
                            <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">${hour}</label>
                            <input type="number" 
                                class="hourly-potential-input w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:border-primary text-base" 
                                data-hour="${hour}" 
                                value="${currentPotential}" 
                                min="0" 
                                step="0.1"
                                placeholder="0">
                        </div>
                    `;
                }).join('');
            }

            copyDefaultPotential() {
                const defaultInput = document.getElementById('front-default-potential');
                if (!defaultInput) return;

                const defaultValue = parseFloat(defaultInput.value) || 0;
                
                document.querySelectorAll('.hourly-potential-input').forEach(input => {
                    input.value = defaultValue;
                });

                this.showToast(`Potencial padrão (${defaultValue}t) aplicado para todas as horas`, 'info');
            }

            switchConfigTab(tab) {
                this.state.ui.activeConfigTab = tab;

                // Update tab buttons
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                const activeBtn = document.querySelector(`[data-tab="${tab}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }

                // Show/hide tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                const targetContent = document.getElementById(`${tab}-tab`);
                if (targetContent) {
                    targetContent.classList.remove('hidden');
                }
            }

            saveFrontConfiguration() {
                const front = this.state.ui.currentConfigFront;
                if (!front) return;

                // Get form values
                const typeSelect = document.getElementById('front-type');
                const goalInput = document.getElementById('front-daily-goal');
                const potentialInput = document.getElementById('front-default-potential');
                const notesInput = document.getElementById('front-notes');

                const type = typeSelect?.value || 'own';
                const dailyGoal = parseFloat(goalInput?.value) || 0;
                const defaultPotential = parseFloat(potentialInput?.value) || 0;
                const notes = notesInput?.value || '';

                // Get hourly potential values
                const hourlyPotential = {};
                document.querySelectorAll('.hourly-potential-input').forEach(input => {
                    const hour = input.dataset.hour;
                    const value = parseFloat(input.value) || 0;
                    hourlyPotential[hour] = value;
                });

                // Update configuration
                this.state.data.frontConfigs[front] = {
                    type,
                    dailyGoal,
                    defaultPotential,
                    hourlyPotential,
                    notes
                };

                // Update global goals
                this.updateGlobalGoals();

                // Update UI
                this.generateFrontConfigCards();
                this.updateAllRealData();
                this.updateCharts();

                // Mark as having changes
                this.state.ui.unsavedChanges = true;

                // Hide modal
                this.hideFrontConfigModal();

                this.showToast(`⚙️ Configuração da Frente ${front} salva com sucesso`, 'success');
                console.log(`⚙️ Configuração da Frente ${front} atualizada:`, this.state.data.frontConfigs[front]);
            }

            // Reports System
            generateReport(type) {
                this.showLoadingOverlay('Gerando relatório...');

                setTimeout(() => {
                    const reportData = this.generateReportData(type);
                    
                    switch (type) {
                        case 'daily':
                            this.generateDailyReport(reportData);
                            break;
                        case 'performance':
                            this.generatePerformanceReport(reportData);
                            break;
                        case 'efficiency':
                            this.generateEfficiencyReport(reportData);
                            break;
                        default:
                            this.generateCustomReport(type, reportData);
                    }

                    // Update reports history
                    this.updateReportsHistory(type);
                    this.updateReportsLastGenerated();

                    this.hideLoadingOverlay();
                    this.showToast(`📄 Relatório ${this.getReportTypeName(type)} gerado com sucesso`, 'success');
                }, 1500);
            }

            generateReportData(type) {
                const separatedData = this.calculateSeparatedData();
                const allStats = this.calculateAllPeriodStats();
                
                return {
                    date: this.state.currentDate,
                    timestamp: new Date().toISOString(),
                    version: this.version,
                    type,
                    separatedData,
                    allStats,
                    fronts: this.state.fronts.map(front => ({
                        front,
                        config: this.state.data.frontConfigs[front],
                        totals: this.calculateFrontTotals(front),
                        periods: this.timeSlots.map(slot => ({
                            period: slot.period,
                            data: this.state.data.periods[slot.period].fronts[front]
                        }))
                    })),
                    periods: this.timeSlots.map(slot => ({
                        slot,
                        hasData: this.periodHasData(slot.period),
                        totals: this.calculatePeriodTotals(slot.period)
                    }))
                };
            }

            calculatePeriodTotals(period) {
                let totalDelivery = 0;
                let totalTrips = 0;
                let totalPotential = 0;

                this.state.fronts.forEach(front => {
                    const frontData = this.state.data.periods[period].fronts[front];
                    if (frontData) {
                        totalDelivery += frontData.total.delivery;
                        totalTrips += frontData.total.trips;

                        if (frontData.total.trips > 0) {
                            const config = this.state.data.frontConfigs[front];
                            if (config?.hourlyPotential) {
                                const timeSlot = this.getTimeSlotByPeriod(period);
                                if (timeSlot) {
                                    timeSlot.hours.forEach(hour => {
                                        totalPotential += parseFloat(config.hourlyPotential[hour]) || 0;
                                    });
                                }
                            }
                        }
                    }
                });

                return { totalDelivery, totalTrips, totalPotential };
            }

            generateDailyReport(data) {
                // Generate PDF report using jsPDF
                if (typeof window.jspdf === 'undefined') {
                    console.error('jsPDF não disponível');
                    this.showToast('Erro: Biblioteca de PDF não carregada', 'error');
                    return;
                }

                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Header
                doc.setFontSize(20);
                doc.text('GGOMES-LOG - Relatório Diário v8.3', 20, 30);
                doc.setFontSize(12);
                doc.text(`Data: ${this.formatDate(data.date)}`, 20, 45);
                doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 20, 55);
                doc.text(`✅ FÓRMULA CORRIGIDA + SEPARAÇÃO PRÓPRIAS/TERCEIRAS`, 20, 65);

                // Summary section
                doc.setFontSize(14);
                doc.text('Resumo Geral', 20, 85);
                
                const summaryData = [
                    ['Métrica', 'Total', 'Próprias', 'Terceiras'],
                    ['Entregue (t)', data.separatedData.total.delivered.toFixed(1), data.separatedData.own.delivered.toFixed(1), data.separatedData.third.delivered.toFixed(1)],
                    ['Não Entregue (t)', data.separatedData.total.missing.toFixed(1), data.separatedData.own.missing.toFixed(1), data.separatedData.third.missing.toFixed(1)],
                    ['Potencial (t)', data.separatedData.total.potential.toFixed(1), data.separatedData.own.potential.toFixed(1), data.separatedData.third.potential.toFixed(1)],
                    ['Eficiência (%)', data.separatedData.total.efficiency.toFixed(1), data.separatedData.own.efficiency.toFixed(1), data.separatedData.third.efficiency.toFixed(1)],
                    ['Viagens', data.separatedData.total.trips.toString(), data.separatedData.own.trips.toString(), data.separatedData.third.trips.toString()]
                ];

                doc.autoTable({
                    head: [summaryData[0]],
                    body: summaryData.slice(1),
                    startY: 95,
                    theme: 'grid',
                    styles: { fontSize: 10 }
                });

                // Fronts details
                doc.addPage();
                doc.setFontSize(14);
                doc.text('Detalhamento por Frente', 20, 30);

                const frontsData = data.fronts.map(frontInfo => [
                    `F${frontInfo.front}`,
                    frontInfo.config?.type === 'own' ? 'Própria' : 'Terceira',
                    frontInfo.totals.delivered.toFixed(1),
                    frontInfo.totals.missing.toFixed(1),
                    frontInfo.totals.potential.toFixed(1),
                    frontInfo.totals.potential > 0 ? ((frontInfo.totals.delivered / frontInfo.totals.potential) * 100).toFixed(1) : '0',
                    frontInfo.totals.trips.toString()
                ]);

                doc.autoTable({
                    head: [['Frente', 'Tipo', 'Entregue (t)', 'Devedor (t)', 'Potencial (t)', 'Eficiência (%)', 'Viagens']],
                    body: frontsData,
                    startY: 40,
                    theme: 'grid',
                    styles: { fontSize: 9 }
                });

                // Save PDF
                const fileName = `GGOMES-LOG_Relatorio_Diario_${data.date.replace(/-/g, '')}_v83.pdf`;
                doc.save(fileName);

                console.log('📄 Relatório diário gerado:', fileName);
            }

            generatePerformanceReport(data) {
                // Generate performance analysis report
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Header
                doc.setFontSize(20);
                doc.text('GGOMES-LOG - Análise de Performance v8.3', 20, 30);
                doc.setFontSize(12);
                doc.text(`Data: ${this.formatDate(data.date)}`, 20, 45);
                doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 20, 55);

                // Performance ranking
                const ranking = data.fronts
                    .map(frontInfo => ({
                        front: frontInfo.front,
                        type: frontInfo.config?.type === 'own' ? 'Própria' : 'Terceira',
                        efficiency: frontInfo.totals.potential > 0 ? (frontInfo.totals.delivered / frontInfo.totals.potential) * 100 : 0,
                        delivered: frontInfo.totals.delivered,
                        trips: frontInfo.totals.trips
                    }))
                    .sort((a, b) => b.efficiency - a.efficiency);

                doc.setFontSize(14);
                doc.text('Ranking de Performance (por Eficiência)', 20, 75);

                const rankingData = ranking.map((item, index) => [
                    `${index + 1}º`,
                    `F${item.front}`,
                    item.type,
                    `${item.efficiency.toFixed(1)}%`,
                    `${item.delivered.toFixed(1)}t`,
                    item.trips.toString()
                ]);

                doc.autoTable({
                    head: [['Posição', 'Frente', 'Tipo', 'Eficiência', 'Entregue', 'Viagens']],
                    body: rankingData,
                    startY: 85,
                    theme: 'grid',
                    styles: { fontSize: 10 }
                });

                // Analysis
                doc.addPage();
                doc.setFontSize(14);
                doc.text('Análise Comparativa', 20, 30);

                const bestFront = ranking[0];
                const worstFront = ranking[ranking.length - 1];

                const analysisText = [
                    `Melhor Performance: Frente ${bestFront.front} (${bestFront.type}) - ${bestFront.efficiency.toFixed(1)}%`,
                    `Menor Performance: Frente ${worstFront.front} (${worstFront.type}) - ${worstFront.efficiency.toFixed(1)}%`,
                    ``,
                    `Eficiência Média Próprias: ${data.separatedData.own.efficiency.toFixed(1)}%`,
                    `Eficiência Média Terceiras: ${data.separatedData.third.efficiency.toFixed(1)}%`,
                    ``,
                    `Total de Períodos Ativos: ${data.allStats.activePeriods}`,
                    `Caminhões por Hora Média: ${data.allStats.trucksPerHour.toFixed(1)}`
                ];

                let yPosition = 50;
                analysisText.forEach(line => {
                    doc.setFontSize(11);
                    doc.text(line, 20, yPosition);
                    yPosition += 10;
                });

                const fileName = `GGOMES-LOG_Analise_Performance_${data.date.replace(/-/g, '')}_v83.pdf`;
                doc.save(fileName);

                console.log('📊 Relatório de performance gerado:', fileName);
            }

            generateEfficiencyReport(data) {
                // Generate efficiency and missing delivery report
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Header
                doc.setFontSize(20);
                doc.text('GGOMES-LOG - Relatório de Saldo Devedor v8.3', 20, 30);
                doc.setFontSize(12);
                doc.text(`Data: ${this.formatDate(data.date)}`, 20, 45);
                doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, 20, 55);

                // Missing delivery by front
                const missingData = data.fronts
                    .filter(frontInfo => frontInfo.totals.missing > 0)
                    .map(frontInfo => [
                        `F${frontInfo.front}`,
                        frontInfo.config?.type === 'own' ? 'Própria' : 'Terceira',
                        frontInfo.totals.missing.toFixed(1),
                        frontInfo.totals.potential.toFixed(1),
                        frontInfo.totals.potential > 0 ? ((frontInfo.totals.missing / frontInfo.totals.potential) * 100).toFixed(1) : '0'
                    ])
                    .sort((a, b) => parseFloat(b[2]) - parseFloat(a[2]));

                doc.setFontSize(14);
                doc.text('Saldo Devedor por Frente', 20, 75);

                if (missingData.length > 0) {
                    doc.autoTable({
                        head: [['Frente', 'Tipo', 'Não Entregue (t)', 'Potencial (t)', '% do Potencial']],
                        body: missingData,
                        startY: 85,
                        theme: 'grid',
                        styles: { fontSize: 10 }
                    });
                } else {
                    doc.setFontSize(12);
                    doc.text('✅ Nenhum saldo devedor encontrado - Todas as frentes atingiram o potencial!', 20, 95);
                }

                // Summary by type
                doc.addPage();
                doc.setFontSize(14);
                doc.text('Resumo por Tipo de Frente', 20, 30);

                const typeData = [
                    ['Tipo', 'Saldo Devedor (t)', 'Potencial Total (t)', '% do Total'],
                    ['Próprias', data.separatedData.own.missing.toFixed(1), data.separatedData.own.potential.toFixed(1), data.separatedData.own.potential > 0 ? ((data.separatedData.own.missing / data.separatedData.own.potential) * 100).toFixed(1) : '0'],
                    ['Terceiras', data.separatedData.third.missing.toFixed(1), data.separatedData.third.potential.toFixed(1), data.separatedData.third.potential > 0 ? ((data.separatedData.third.missing / data.separatedData.third.potential) * 100).toFixed(1) : '0'],
                    ['TOTAL', data.separatedData.total.missing.toFixed(1), data.separatedData.total.potential.toFixed(1), data.separatedData.total.potential > 0 ? ((data.separatedData.total.missing / data.separatedData.total.potential) * 100).toFixed(1) : '0']
                ];

                doc.autoTable({
                    head: [typeData[0]],
                    body: typeData.slice(1),
                    startY: 40,
                    theme: 'grid',
                    styles: { fontSize: 11 }
                });

                const fileName = `GGOMES-LOG_Saldo_Devedor_${data.date.replace(/-/g, '')}_v83.pdf`;
                doc.save(fileName);

                console.log('🔍 Relatório de saldo devedor gerado:', fileName);
            }

            generateAllReports() {
                this.showLoadingOverlay('Gerando todos os relatórios...');

                const reportTypes = ['daily', 'performance', 'efficiency'];
                let completed = 0;

                reportTypes.forEach((type, index) => {
                    setTimeout(() => {
                        this.generateReport(type);
                        completed++;
                        
                        if (completed === reportTypes.length) {
                            this.hideLoadingOverlay();
                            this.showToast('📄 Todos os relatórios foram gerados com sucesso!', 'success');
                        }
                    }, index * 800); // Stagger generation
                });
            }

            updateReportsHistory(type) {
                const report = {
                    type,
                    name: this.getReportTypeName(type),
                    date: this.state.currentDate,
                    timestamp: new Date().toISOString(),
                    size: 'PDF'
                };

                this.state.reports.history.unshift(report);
                
                // Keep only last 20 reports
                if (this.state.reports.history.length > 20) {
                    this.state.reports.history = this.state.reports.history.slice(0, 20);
                }

                this.state.reports.lastGenerated[type] = new Date().toISOString();
            }

            updateReportsLastGenerated() {
                Object.keys(this.state.reports.lastGenerated).forEach(type => {
                    const element = document.getElementById(`${type}-last-gen`);
                    if (element) {
                        const date = new Date(this.state.reports.lastGenerated[type]);
                        element.textContent = date.toLocaleString('pt-BR');
                    }
                });
            }

            getReportTypeName(type) {
                const names = {
                    'daily': 'Relatório Diário',
                    'performance': 'Análise de Performance',
                    'efficiency': 'Saldo Devedor',
                    'weekly': 'Relatório Semanal',
                    'monthly': 'Relatório Mensal'
                };
                return names[type] || type;
            }

            scheduleReports() {
                this.showToast('🕒 Funcionalidade de agendamento será implementada em breve', 'info');
            }

            exportReportsConfig() {
                const config = {
                    version: this.version,
                    timestamp: new Date().toISOString(),
                    reportsConfig: this.state.reports,
                    frontConfigs: this.state.data.frontConfigs
                };

                const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `GGOMES-LOG_Config_Relatorios_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);

                this.showToast('📥 Configuração de relatórios exportada', 'success');
            }

            clearReportsHistory() {
                if (!confirm('Tem certeza que deseja limpar o histórico de relatórios?')) {
                    return;
                }

                this.state.reports.history = [];
                this.showToast('🧹 Histórico de relatórios limpo', 'info');
            }

            // Utility Functions
            toggleSidebar(force) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('sidebar-overlay');
                
                if (force !== undefined) {
                    this.state.ui.sidebarOpen = force;
                } else {
                    this.state.ui.sidebarOpen = !this.state.ui.sidebarOpen;
                }

                if (sidebar) {
                    sidebar.classList.toggle('-translate-x-full', !this.state.ui.sidebarOpen);
                }
                if (overlay) {
                    overlay.classList.toggle('hidden', !this.state.ui.sidebarOpen);
                }
            }

            toggleTheme() {
                const isDark = document.documentElement.classList.contains('dark');
                if (isDark) {
                    document.documentElement.classList.remove('dark');
                    this.state.config.theme = 'light';
                } else {
                    document.documentElement.classList.add('dark');
                    this.state.config.theme = 'dark';
                }
                
                this.updateThemeIcons();
                this.updateChartsTheme();
                
                this.showToast(`🎨 Tema alterado para ${isDark ? 'claro' : 'escuro'}`, 'info');
            }

            showPage(page) {
                this.state.currentPage = page;

                // Update navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                const activeLink = document.querySelector(`[data-page="${page}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }

                // Show/hide content
                document.querySelectorAll('.page-content').forEach(content => {
                    content.classList.add('hidden');
                });
                const targetContent = document.getElementById(`${page}-content`);
                if (targetContent) {
                    targetContent.classList.remove('hidden');
                }

                // Page-specific updates
                switch (page) {
                    case 'dashboard':
                        this.updateAllRealData();
                        this.updateCharts();
                        break;
                    case 'entrega-hora':
                        this.generateTimePeriodButtons();
                        this.updateCurrentInputMode();
                        this.updateQuickStats();
                        break;
                    case 'frentes-config':
                        this.generateFrontConfigCards();
                        break;
                    case 'relatorios':
                        this.updateReportsLastGenerated();
                        break;
                }

                console.log(`📄 Página alterada para: ${page}`);
            }

            showSearch() {
                const modal = document.getElementById('search-modal');
                if (modal) {
                    modal.classList.remove('hidden');
                    const input = document.getElementById('search-input');
                    if (input) {
                        setTimeout(() => input.focus(), 100);
                    }
                }
            }

            hideSearch() {
                const modal = document.getElementById('search-modal');
                if (modal) {
                    modal.classList.add('hidden');
                }
            }

            handleSearch(event) {
                const query = event.target.value.toLowerCase();
                const resultsContainer = document.getElementById('search-results');
                
                if (!query) {
                    resultsContainer.innerHTML = `
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                            <p>Digite para pesquisar...</p>
                        </div>
                    `;
                    return;
                }

                // Search logic
                const results = [];
                
                // Search fronts
                this.state.fronts.forEach(front => {
                    if (front.toLowerCase().includes(query)) {
                        results.push({
                            title: `Frente ${front}`,
                            description: 'Configuração de frente',
                            action: () => {
                                this.showPage('frentes-config');
                                this.hideSearch();
                                setTimeout(() => this.showFrontConfigModal(front), 300);
                            }
                        });
                    }
                });

                // Search periods
                this.timeSlots.forEach(slot => {
                    if (slot.start.includes(query) || slot.end.includes(query)) {
                        results.push({
                            title: `Período ${slot.start}-${slot.end}`,
                            description: 'Entrada de dados por período',
                            action: () => {
                                this.showPage('entrega-hora');
                                this.switchTimePeriod(slot.period);
                                this.hideSearch();
                            }
                        });
                    }
                });

                // Display results
                if (results.length === 0) {
                    resultsContainer.innerHTML = `
                        <div class="text-center py-8 text-gray-500 dark:text-gray-400">
                            <p>Nenhum resultado encontrado para "${query}"</p>
                        </div>
                    `;
                } else {
                    resultsContainer.innerHTML = results.map(result => `
                        <div class="search-result p-4 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer transition-all duration-300" onclick="(${result.action.toString()})()">
                            <div class="font-semibold text-gray-900 dark:text-white">${result.title}</div>
                            <div class="text-sm text-gray-500 dark:text-gray-400">${result.description}</div>
                        </div>
                    `).join('');
                }
            }

            showNotifications() {
                // Update notification count
                const badge = document.getElementById('notification-badge');
                if (badge) {
                    const separatedData = this.calculateSeparatedData();
                    let notificationCount = 0;
                    
                    // Check for low efficiency
                    if (separatedData.total.efficiency < 70) notificationCount++;
                    
                    // Check for missing deliveries
                    if (separatedData.total.missing > 100) notificationCount++;
                    
                    badge.textContent = notificationCount;
                    badge.style.display = notificationCount > 0 ? 'flex' : 'none';
                }

                this.showToast('📱 Sistema de notificações será aprimorado em breve', 'info');
            }

            showQuickActions() {
                this.showToast('⚡ Menu de ações rápidas será implementado em breve', 'info');
            }

            clearCurrentPeriod() {
                if (!confirm(`Tem certeza que deseja limpar todos os dados do período ${this.getTimeSlotByPeriod(this.state.activePeriod)?.start || this.state.activePeriod}?`)) {
                    return;
                }

                this.clearPeriodInputs();
            }

            exportCurrentPeriod() {
                const timeSlot = this.getTimeSlotByPeriod(this.state.activePeriod);
                const periodData = {
                    period: this.state.activePeriod,
                    timeSlot,
                    date: this.state.currentDate,
                    data: this.state.data.periods[this.state.activePeriod],
                    timestamp: new Date().toISOString()
                };

                const blob = new Blob([JSON.stringify(periodData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `GGOMES-LOG_Periodo_${this.state.activePeriod}_${this.state.currentDate}.json`;
                a.click();
                URL.revokeObjectURL(url);

                this.showToast(`📁 Dados do período ${timeSlot?.start || this.state.activePeriod} exportados`, 'success');
            }

            exportDashboard() {
                const dashboardData = {
                    date: this.state.currentDate,
                    timestamp: new Date().toISOString(),
                    version: this.version,
                    separatedData: this.calculateSeparatedData(),
                    allStats: this.calculateAllPeriodStats(),
                    fronts: this.state.fronts,
                    configs: this.state.data.frontConfigs
                };

                const blob = new Blob([JSON.stringify(dashboardData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `GGOMES-LOG_Dashboard_${this.state.currentDate}.json`;
                a.click();
                URL.revokeObjectURL(url);

                this.showToast('📊 Dados do dashboard exportados', 'success');
            }

            exportTable() {
                const data = this.state.fronts.map(front => {
                    const frontTotals = this.calculateFrontTotals(front);
                    const config = this.state.data.frontConfigs[front] || {};
                    const efficiency = frontTotals.potential > 0 ? (frontTotals.delivered / frontTotals.potential) * 100 : 0;
                    
                    return {
                        Frente: front,
                        Tipo: config.type === 'own' ? 'Própria' : 'Terceira',
                        'Entregue (t)': frontTotals.delivered.toFixed(1),
                        'Não Entregue (t)': frontTotals.missing.toFixed(1),
                        'Potencial (t)': frontTotals.potential.toFixed(1),
                        'Eficiência (%)': efficiency.toFixed(1),
                        'Viagens': frontTotals.trips,
                        'Meta Diária (t)': (config.dailyGoal || 0).toFixed(0)
                    };
                });

                const csv = Papa.unparse(data);
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `GGOMES-LOG_Tabela_${this.state.currentDate}.csv`;
                a.click();
                URL.revokeObjectURL(url);

                this.showToast('📋 Tabela exportada como CSV', 'success');
            }

            refreshDashboard() {
                this.updateAllRealData();
                this.updateQuickStats();
                this.updateActiveEntriesCount();
                this.updatePeriodProgress();
                this.updateCharts();
                this.generateDashboardTable();
                this.generateIndividualPerformanceCards();
                
                this.showToast('🔄 Dashboard atualizado', 'success');
            }

            importConfiguration() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            try {
                                const config = JSON.parse(event.target.result);
                                
                                if (config.frontConfigs) {
                                    this.state.data.frontConfigs = { ...this.state.data.frontConfigs, ...config.frontConfigs };
                                }
                                
                                if (config.fronts) {
                                    this.state.fronts = [...new Set([...this.state.fronts, ...config.fronts])];
                                }
                                
                                this.updateGlobalGoals();
                                this.generateFrontConfigCards();
                                this.updateAllRealData();
                                this.state.ui.unsavedChanges = true;
                                
                                this.showToast('📥 Configuração importada com sucesso', 'success');
                            } catch (error) {
                                console.error('Erro ao importar configuração:', error);
                                this.showToast('Erro ao importar configuração', 'error');
                            }
                        };
                        reader.readAsText(file);
                    }
                });
                input.click();
            }

            exportConfiguration() {
                const config = {
                    version: this.version,
                    timestamp: new Date().toISOString(),
                    fronts: this.state.fronts,
                    frontConfigs: this.state.data.frontConfigs,
                    dailyGoals: this.state.data.dailyGoals,
                    config: this.state.config
                };

                const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `GGOMES-LOG_Configuracao_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);

                this.showToast('📤 Configuração exportada', 'success');
            }

            handleKeyboardShortcuts(event) {
                if (event.ctrlKey || event.metaKey) {
                    switch (event.key) {
                        case 's':
                            event.preventDefault();
                            this.saveData();
                            break;
                        case 'k':
                            event.preventDefault();
                            this.showSearch();
                            break;
                        case 'd':
                            event.preventDefault();
                            this.toggleTheme();
                            break;
                    }
                }

                if (event.altKey) {
                    switch (event.key) {
                        case 'ArrowLeft':
                            event.preventDefault();
                            this.navigateDate(-1);
                            break;
                        case 'ArrowRight':
                            event.preventDefault();
                            this.navigateDate(1);
                            break;
                    }
                }

                if (event.key === 'Escape') {
                    this.hideSearch();
                }
            }

            handleResize() {
                // Auto-close sidebar on mobile
                if (window.innerWidth < 1024 && this.state.ui.sidebarOpen) {
                    this.toggleSidebar(false);
                }

                // Update charts if needed
                if (this.charts) {
                    Object.values(this.charts).forEach(chart => {
                        if (chart && chart.resize) {
                            chart.resize();
                        }
                    });
                }
            }

            handleTableSearch(event) {
                const query = event.target.value.toLowerCase();
                const rows = document.querySelectorAll('#performance-table tr');
                
                rows.forEach(row => {
                    const frontCell = row.querySelector('td');
                    if (frontCell) {
                        const frontText = frontCell.textContent.toLowerCase();
                        row.style.display = frontText.includes(query) ? '' : 'none';
                    }
                });
            }

            showFrontDetails(front) {
                // Show detailed modal with front performance data
                const frontTotals = this.calculateFrontTotals(front);
                const config = this.state.data.frontConfigs[front] || {};
                
                const details = `
                    Frente: ${front}
                    Tipo: ${config.type === 'own' ? 'Própria' : 'Terceira'}
                    Entregue: ${frontTotals.delivered.toFixed(1)}t
                    Potencial: ${frontTotals.potential.toFixed(1)}t
                    Eficiência: ${frontTotals.potential > 0 ? ((frontTotals.delivered / frontTotals.potential) * 100).toFixed(1) : '0'}%
                    Viagens: ${frontTotals.trips}
                    Meta Diária: ${config.dailyGoal || 0}t
                `;
                
                alert(details); // Simple alert for now, could be enhanced with a modal
            }

            showPeriodHelp() {
                const helpText = `
                🕒 AJUDA - NAVEGAÇÃO POR PERÍODOS

                • Clique em um período para inserir dados
                • Períodos com dados têm indicador verde
                • Use "Entrada Rápida" para aplicar valores padrão
                • "Copiar Anterior" duplica dados do período anterior
                
                ⌨️ ATALHOS DE TECLADO:
                • Ctrl+S: Salvar dados
                • Ctrl+K: Busca rápida
                • Alt+← / Alt+→: Navegar datas
                • Esc: Fechar modais

                💡 DICAS:
                • Entrega = Densidade × Viagens (fórmula corrigida)
                • Potencial só conta horas com dados
                • Frentes próprias e terceiras são separadas
                `;
                
                alert(helpText);
            }

            startPeriodicUpdates() {
                // Auto-save every 30 seconds
                setInterval(() => {
                    if (this.state.ui.unsavedChanges) {
                        this.saveData();
                    }
                }, this.state.config.autoSaveInterval);

                // Update charts every 5 seconds if data changed
                setInterval(() => {
                    if (this.state.ui.unsavedChanges) {
                        this.updateCharts();
                    }
                }, this.state.config.chartUpdateInterval);

                console.log('⏰ Atualizações periódicas iniciadas');
            }

            showLoadingOverlay(message = 'Carregando...') {
                const overlay = document.getElementById('loading-overlay');
                const messageElement = document.getElementById('loading-message');
                
                if (overlay) {
                    overlay.classList.remove('hidden');
                }
                if (messageElement) {
                    messageElement.textContent = message;
                }
            }

            hideLoadingOverlay() {
                const overlay = document.getElementById('loading-overlay');
                if (overlay) {
                    overlay.classList.add('hidden');
                }
            }

            hideLoader() {
                const loader = document.getElementById('app-loader');
                if (loader) {
                    loader.style.opacity = '0';
                    setTimeout(() => {
                        loader.style.display = 'none';
                    }, 500);
                }
            }

            showToast(message, type = 'info') {
                const container = document.getElementById('toast-container');
                if (!container) return;

                const toast = document.createElement('div');
                toast.className = `toast relative px-6 py-4 rounded-xl shadow-lg transform transition-all duration-500 ease-in-out translate-x-full opacity-0`;
                
                const colors = {
                    success: 'bg-green-500 text-white',
                    error: 'bg-red-500 text-white',
                    warning: 'bg-yellow-500 text-white',
                    info: 'bg-blue-500 text-white'
                };

                toast.className += ` ${colors[type] || colors.info}`;
                toast.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <span class="flex-1">${message}</span>
                        <button class="ml-4 text-white hover:text-gray-200 transition-colors" onclick="this.parentElement.parentElement.remove()">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                `;

                container.appendChild(toast);

                // Animate in
                setTimeout(() => {
                    toast.classList.remove('translate-x-full', 'opacity-0');
                }, 100);

                // Auto remove after 5 seconds
                setTimeout(() => {
                    toast.classList.add('translate-x-full', 'opacity-0');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 500);
                }, 5000);

                console.log(`🔔 Toast: ${message}`);
            }
        }

        // Initialize the system when DOM is loaded
        let ggomesSystem;
        document.addEventListener('DOMContentLoaded', () => {
            ggomesSystem = new GGomesLogSystemEnhanced();
            
            // Make system globally available for inline onclick handlers
            window.ggomesSystem = ggomesSystem;
        });

        // Handle page unload with unsaved changes warning
        window.addEventListener('beforeunload', (e) => {
            if (ggomesSystem && ggomesSystem.state.ui.unsavedChanges) {
                e.preventDefault();
                e.returnValue = 'Você tem alterações não salvas. Deseja sair mesmo assim?';
                return e.returnValue;
            }
        });
    </script>
</body>
</html>
